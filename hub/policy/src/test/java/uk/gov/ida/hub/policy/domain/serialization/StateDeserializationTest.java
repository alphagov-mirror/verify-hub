package uk.gov.ida.hub.policy.domain.serialization;

import org.joda.time.DateTime;
import org.junit.After;
import org.junit.Before;
import org.junit.Test;
import uk.gov.ida.hub.policy.domain.SessionId;
import uk.gov.ida.hub.policy.domain.state.AuthnFailedErrorState;
import uk.gov.ida.hub.policy.domain.state.AwaitingCycle3DataState;
import uk.gov.ida.hub.policy.domain.state.EidasAuthnFailedErrorState;
import uk.gov.ida.hub.policy.domain.state.EidasCountrySelectedState;
import uk.gov.ida.hub.policy.domain.state.EidasUserAccountCreationFailedState;
import uk.gov.ida.hub.policy.domain.state.Cycle0And1MatchRequestSentState;
import uk.gov.ida.hub.policy.domain.state.Cycle3DataInputCancelledState;
import uk.gov.ida.hub.policy.domain.state.Cycle3MatchRequestSentState;
import uk.gov.ida.hub.policy.domain.state.EidasAwaitingCycle3DataState;
import uk.gov.ida.hub.policy.domain.state.EidasCycle0And1MatchRequestSentState;
import uk.gov.ida.hub.policy.domain.state.EidasCycle3MatchRequestSentState;
import uk.gov.ida.hub.policy.domain.state.EidasSuccessfulMatchState;
import uk.gov.ida.hub.policy.domain.state.EidasUserAccountCreationRequestSentState;
import uk.gov.ida.hub.policy.domain.state.FraudEventDetectedState;
import uk.gov.ida.hub.policy.domain.state.IdpSelectedState;
import uk.gov.ida.hub.policy.domain.state.MatchingServiceRequestErrorState;
import uk.gov.ida.hub.policy.domain.state.NoMatchState;
import uk.gov.ida.hub.policy.domain.state.PausedRegistrationState;
import uk.gov.ida.hub.policy.domain.state.RequesterErrorState;
import uk.gov.ida.hub.policy.domain.state.SessionStartedState;
import uk.gov.ida.hub.policy.domain.state.SuccessfulMatchState;
import uk.gov.ida.hub.policy.domain.state.TimeoutState;
import uk.gov.ida.hub.policy.domain.state.UserAccountCreatedState;
import uk.gov.ida.hub.policy.domain.state.UserAccountCreationFailedState;
import uk.gov.ida.hub.policy.domain.state.UserAccountCreationRequestSentState;
import uk.gov.ida.shared.utils.datetime.DateTimeFreezer;

import static uk.gov.ida.hub.policy.builder.state.AuthnFailedErrorStateBuilder.anAuthnFailedErrorState;
import static uk.gov.ida.hub.policy.builder.state.AwaitingCycle3DataStateBuilder.anAwaitingCycle3DataState;
import static uk.gov.ida.hub.policy.builder.state.EidasAuthnFailedErrorStateBuilder.anEidasAuthnFailedErrorState;
import static uk.gov.ida.hub.policy.builder.state.EidasCountrySelectedStateBuilder.anEidasCountrySelectedState;
import static uk.gov.ida.hub.policy.builder.state.EidasUserAccountCreationFailedStateBuilder.aEidasUserAccountCreationFailedState;
import static uk.gov.ida.hub.policy.builder.state.Cycle0And1MatchRequestSentStateBuilder.aCycle0And1MatchRequestSentState;
import static uk.gov.ida.hub.policy.builder.state.Cycle3DataInputCancelledStateBuilder.aCycle3DataInputCancelledState;
import static uk.gov.ida.hub.policy.builder.state.Cycle3MatchRequestSentStateBuilder.aCycle3MatchRequestSentState;
import static uk.gov.ida.hub.policy.builder.state.EidasAwaitingCycle3DataStateBuilder.anEidasAwaitingCycle3DataState;
import static uk.gov.ida.hub.policy.builder.state.EidasCycle0And1MatchRequestSentStateBuilder.anEidasCycle0And1MatchRequestSentState;
import static uk.gov.ida.hub.policy.builder.state.EidasCycle3MatchRequestSentStateBuilder.anEidasCycle3MatchRequestSentState;
import static uk.gov.ida.hub.policy.builder.state.EidasSuccessfulMatchStateBuilder.anEidasSuccessfulMatchState;
import static uk.gov.ida.hub.policy.builder.state.EidasUserAccountCreationRequestSentStateBuilder.anEidasUserAccountCreationRequestSentState;
import static uk.gov.ida.hub.policy.builder.state.FraudEventDetectedStateBuilder.aFraudEventDetectedState;
import static uk.gov.ida.hub.policy.builder.state.IdpSelectedStateBuilder.anIdpSelectedState;
import static uk.gov.ida.hub.policy.builder.state.MatchingServiceRequestErrorStateBuilder.aMatchingServiceRequestErrorState;
import static uk.gov.ida.hub.policy.builder.state.NoMatchStateBuilder.aNoMatchState;
import static uk.gov.ida.hub.policy.builder.state.PausedRegistrationStateBuilder.aPausedRegistrationState;
import static uk.gov.ida.hub.policy.builder.state.RequesterErrorStateBuilder.aRequesterErrorState;
import static uk.gov.ida.hub.policy.builder.state.SessionStartedStateBuilder.aSessionStartedState;
import static uk.gov.ida.hub.policy.builder.state.SuccessfulMatchStateBuilder.aSuccessfulMatchState;
import static uk.gov.ida.hub.policy.builder.state.TimeoutStateBuilder.aTimeoutState;
import static uk.gov.ida.hub.policy.builder.state.UserAccountCreatedStateBuilder.aUserAccountCreatedState;
import static uk.gov.ida.hub.policy.builder.state.UserAccountCreationFailedStateBuilder.aUserAccountCreationFailedState;
import static uk.gov.ida.hub.policy.builder.state.UserAccountCreationRequestSentStateBuilder.aUserAccountCreationRequestSentState;
import static uk.gov.ida.hub.policy.domain.serialization.StateSerializationHelpers.assertDeserializedForm;

/**
 * Tests that check that the "State" objects which we store in infinispan can be deserialized.
 *
 * In each case we take a blob of base64 encoded serialized data, deserialize it, and check that it matches an expected
 * object (by comparing field-by-field).
 *
 * These tests are intended to catch the situation where a change is made to a State that means serialized data cannot be
 * deserialized cleanly to the state objects. This usually causes issues during deployment, since there are existing States
 * in the data store which the new code cannot handle.
 *
 * If you change a State in a way that breaks these tests you should first see if your change is actually breaking, or
 * if there's something else going on (e.g. changing the default in a builder).
 *
 * If it looks like your changes are breaking you should see if you can make the changes in a non-breaking way (e.g. by
 * marking new fields that don't need to be persisted as "transient", or by implementing
 * {@link java.io.Externalizable})
 *
 * If you can't make the changes in a non-breaking way you should:
 * - Ensure that deploying the code will not cause an outage, or in extreme cases agree a planned outage with stakeholders
 * - Increment the serialVersionUID on the class you're breaking
 * - Update the serialized data in the test so the test covers the new format
 *
 * @see <a href="https://docs.oracle.com/javase/8/docs/api/java/io/Serializable.html">The javadoc for Serializable</a>
 * @see <a href="https://stackoverflow.com/a/285809/1344760">Stackoverflow explanation of serialVersionUID</a>
 */
public class StateDeserializationTest {

    private static final SessionId SESSION_ID = new SessionId("some-session-id");
    private static final String REQUEST_ID = "some-request-id";

    @Before
    public void setUp() {
        // Some of the states and some of the builders call DateTime.now() in their constructor.
        // That means they don't serialize deterministically unless we freeze time.
        DateTimeFreezer.freezeTime(new DateTime(1988, 1, 1, 0, 0));
    }

    @After
    public void tearDown() {
        DateTimeFreezer.unfreezeTime();
    }

    @Test
    public void shouldDeserializeSessionStartedState() {
        SessionStartedState expectedState = aSessionStartedState().withSessionId(SESSION_ID).build();
        assertDeserializedForm(
            "rO0ABXNyADZ1ay5nb3YuaWRhLmh1Yi5wb2xpY3kuZG9tYWluLnN0YXRlLlNlc3Npb25TdGFydGVkU3RhdGXX4hBgn1pTtwIAAUwACnJlbGF5U3RhdGV0ABJMamF2YS9sYW5nL1N0cmluZzt4cgAqdWsuZ292LmlkYS5odWIucG9saWN5LmRvbWFpbi5BYnN0cmFjdFN0YXRlvknOq/yjU4YCAAdaABh0cmFuc2FjdGlvblN1cHBvcnRzRWlkYXNMABthc3NlcnRpb25Db25zdW1lclNlcnZpY2VVcml0AA5MamF2YS9uZXQvVVJJO0wAE2ZvcmNlQXV0aGVudGljYXRpb250ABNMamF2YS9sYW5nL0Jvb2xlYW47TAAJcmVxdWVzdElkcQB+AAFMABVyZXF1ZXN0SXNzdWVyRW50aXR5SWRxAH4AAUwAFnNlc3Npb25FeHBpcnlUaW1lc3RhbXB0ABhMb3JnL2pvZGEvdGltZS9EYXRlVGltZTtMAAlzZXNzaW9uSWR0AChMdWsvZ292L2lkYS9odWIvcG9saWN5L2RvbWFpbi9TZXNzaW9uSWQ7eHAAcHNyABFqYXZhLmxhbmcuQm9vbGVhbs0gcoDVnPruAgABWgAFdmFsdWV4cAB0AAlyZXF1ZXN0SWR0AA9yZXF1ZXN0SXNzdWVySWRzcgAWb3JnLmpvZGEudGltZS5EYXRlVGltZbg8eGRqW935AgAAeHIAH29yZy5qb2RhLnRpbWUuYmFzZS5CYXNlRGF0ZVRpbWX///nhT10uowIAAkoAB2lNaWxsaXNMAAtpQ2hyb25vbG9neXQAGkxvcmcvam9kYS90aW1lL0Nocm9ub2xvZ3k7eHAAAACEWM5UAHNyACdvcmcuam9kYS50aW1lLmNocm9uby5JU09DaHJvbm9sb2d5JFN0dWKpyBFmcTdQJwMAAHhwc3IAH29yZy5qb2RhLnRpbWUuRGF0ZVRpbWVab25lJFN0dWKmLwGafDIa4wMAAHhwdwUAA1VUQ3h4c3IAJnVrLmdvdi5pZGEuaHViLnBvbGljeS5kb21haW4uU2Vzc2lvbklkyw/NEvqJhlYCAAFMAAlzZXNzaW9uSWRxAH4AAXhwdAAPc29tZS1zZXNzaW9uLWlkcA==",
            expectedState
        );
    }

    @Test
    public void shouldDeserializeEidasCountrySelectedState() {
        EidasCountrySelectedState expectedState = anEidasCountrySelectedState().withSessionId(SESSION_ID).withRequestId(REQUEST_ID).build();
        assertDeserializedForm(
            "rO0ABXNyADx1ay5nb3YuaWRhLmh1Yi5wb2xpY3kuZG9tYWluLnN0YXRlLkVpZGFzQ291bnRyeVNlbGVjdGVkU3RhdGX8CVX1X7d1wgIAA0wAD2NvdW50cnlFbnRpdHlJZHQAEkxqYXZhL2xhbmcvU3RyaW5nO0wAEWxldmVsc09mQXNzdXJhbmNldAAQTGphdmEvdXRpbC9MaXN0O0wACnJlbGF5U3RhdGVxAH4AAXhyACp1ay5nb3YuaWRhLmh1Yi5wb2xpY3kuZG9tYWluLkFic3RyYWN0U3RhdGW+Sc6r/KNThgIAB1oAGHRyYW5zYWN0aW9uU3VwcG9ydHNFaWRhc0wAG2Fzc2VydGlvbkNvbnN1bWVyU2VydmljZVVyaXQADkxqYXZhL25ldC9VUkk7TAATZm9yY2VBdXRoZW50aWNhdGlvbnQAE0xqYXZhL2xhbmcvQm9vbGVhbjtMAAlyZXF1ZXN0SWRxAH4AAUwAFXJlcXVlc3RJc3N1ZXJFbnRpdHlJZHEAfgABTAAWc2Vzc2lvbkV4cGlyeVRpbWVzdGFtcHQAGExvcmcvam9kYS90aW1lL0RhdGVUaW1lO0wACXNlc3Npb25JZHQAKEx1ay9nb3YvaWRhL2h1Yi9wb2xpY3kvZG9tYWluL1Nlc3Npb25JZDt4cABzcgAMamF2YS5uZXQuVVJJrAF4LkOeSasDAAFMAAZzdHJpbmdxAH4AAXhwdAAWL2RlZmF1bHQtc2VydmljZS1pbmRleHhzcgARamF2YS5sYW5nLkJvb2xlYW7NIHKA1Zz67gIAAVoABXZhbHVleHAAdAAPc29tZS1yZXF1ZXN0LWlkdAAPcmVxdWVzdElzc3Vlcklkc3IAFm9yZy5qb2RhLnRpbWUuRGF0ZVRpbWW4PHhkalvd+QIAAHhyAB9vcmcuam9kYS50aW1lLmJhc2UuQmFzZURhdGVUaW1l///54U9dLqMCAAJKAAdpTWlsbGlzTAALaUNocm9ub2xvZ3l0ABpMb3JnL2pvZGEvdGltZS9DaHJvbm9sb2d5O3hwAAAAhD8Xr8BzcgAnb3JnLmpvZGEudGltZS5jaHJvbm8uSVNPQ2hyb25vbG9neSRTdHViqcgRZnE3UCcDAAB4cHNyAB9vcmcuam9kYS50aW1lLkRhdGVUaW1lWm9uZSRTdHVipi8BmnwyGuMDAAB4cHcFAANVVEN4eHNyACZ1ay5nb3YuaWRhLmh1Yi5wb2xpY3kuZG9tYWluLlNlc3Npb25JZMsPzRL6iYZWAgABTAAJc2Vzc2lvbklkcQB+AAF4cHQAD3NvbWUtc2Vzc2lvbi1pZHBwcA==",
            expectedState
        );
    }

    @Test
    public void shouldDeserializeEidasAwaitingCycle3DataState() {
        EidasAwaitingCycle3DataState expectedState = anEidasAwaitingCycle3DataState().withSessionId(SESSION_ID).build();
        assertDeserializedForm(
            "rO0ABXNyAD91ay5nb3YuaWRhLmh1Yi5wb2xpY3kuZG9tYWluLnN0YXRlLkVpZGFzQXdhaXRpbmdDeWNsZTNEYXRhU3RhdGWCUZvxtNbGswIAAUwAGmVuY3J5cHRlZElkZW50aXR5QXNzZXJ0aW9udAASTGphdmEvbGFuZy9TdHJpbmc7eHIAQnVrLmdvdi5pZGEuaHViLnBvbGljeS5kb21haW4uc3RhdGUuQWJzdHJhY3RBd2FpdGluZ0N5Y2xlM0RhdGFTdGF0ZdRvefefNUmAAgAFTAAYaWRlbnRpdHlQcm92aWRlckVudGl0eUlkcQB+AAFMABBsZXZlbE9mQXNzdXJhbmNldAAvTHVrL2dvdi9pZGEvaHViL3BvbGljeS9kb21haW4vTGV2ZWxPZkFzc3VyYW5jZTtMABdtYXRjaGluZ1NlcnZpY2VFbnRpdHlJZHEAfgABTAAMcGVyc2lzdGVudElkdAArTHVrL2dvdi9pZGEvaHViL3BvbGljeS9kb21haW4vUGVyc2lzdGVudElkO0wACnJlbGF5U3RhdGVxAH4AAXhyACp1ay5nb3YuaWRhLmh1Yi5wb2xpY3kuZG9tYWluLkFic3RyYWN0U3RhdGW+Sc6r/KNThgIAB1oAGHRyYW5zYWN0aW9uU3VwcG9ydHNFaWRhc0wAG2Fzc2VydGlvbkNvbnN1bWVyU2VydmljZVVyaXQADkxqYXZhL25ldC9VUkk7TAATZm9yY2VBdXRoZW50aWNhdGlvbnQAE0xqYXZhL2xhbmcvQm9vbGVhbjtMAAlyZXF1ZXN0SWRxAH4AAUwAFXJlcXVlc3RJc3N1ZXJFbnRpdHlJZHEAfgABTAAWc2Vzc2lvbkV4cGlyeVRpbWVzdGFtcHQAGExvcmcvam9kYS90aW1lL0RhdGVUaW1lO0wACXNlc3Npb25JZHQAKEx1ay9nb3YvaWRhL2h1Yi9wb2xpY3kvZG9tYWluL1Nlc3Npb25JZDt4cAFzcgAMamF2YS5uZXQuVVJJrAF4LkOeSasDAAFMAAZzdHJpbmdxAH4AAXhwdAAbYXNzZXJ0aW9uQ29uc3VtZXJTZXJ2aWNlVXJpeHB0AAlyZXF1ZXN0SWR0AA9yZXF1ZXN0SXNzdWVySWRzcgAWb3JnLmpvZGEudGltZS5EYXRlVGltZbg8eGRqW935AgAAeHIAH29yZy5qb2RhLnRpbWUuYmFzZS5CYXNlRGF0ZVRpbWX///nhT10uowIAAkoAB2lNaWxsaXNMAAtpQ2hyb25vbG9neXQAGkxvcmcvam9kYS90aW1lL0Nocm9ub2xvZ3k7eHAAAACEPxevwHNyACdvcmcuam9kYS50aW1lLmNocm9uby5JU09DaHJvbm9sb2d5JFN0dWKpyBFmcTdQJwMAAHhwc3IAH29yZy5qb2RhLnRpbWUuRGF0ZVRpbWVab25lJFN0dWKmLwGafDIa4wMAAHhwdwUAA1VUQ3h4c3IAJnVrLmdvdi5pZGEuaHViLnBvbGljeS5kb21haW4uU2Vzc2lvbklkyw/NEvqJhlYCAAFMAAlzZXNzaW9uSWRxAH4AAXhwdAAPc29tZS1zZXNzaW9uLWlkdAAYaWRlbnRpdHlQcm92aWRlckVudGl0eUlkfnIALXVrLmdvdi5pZGEuaHViLnBvbGljeS5kb21haW4uTGV2ZWxPZkFzc3VyYW5jZQAAAAAAAAAAEgAAeHIADmphdmEubGFuZy5FbnVtAAAAAAAAAAASAAB4cHQAB0xFVkVMXzJ0AB5tYXRjaGluZ1NlcnZpY2VBZGFwdGVyRW50aXR5SWRzcgApdWsuZ292LmlkYS5odWIucG9saWN5LmRvbWFpbi5QZXJzaXN0ZW50SWTB/UPEwbB0xQIAAUwABm5hbWVJZHEAfgABeHB0AAZuYW1lSWR0AApyZWxheVN0YXRldAAaZW5jcnlwdGVkSWRlbnRpdHlBc3NlcnRpb24=",
            expectedState);
    }

    @Test
    public void shouldDeserializeAwaitingCycle3DataState() {
        AwaitingCycle3DataState expectedState = anAwaitingCycle3DataState()
            .withSessionId(SESSION_ID)
            .build();
        assertDeserializedForm(
            "rO0ABXNyADp1ay5nb3YuaWRhLmh1Yi5wb2xpY3kuZG9tYWluLnN0YXRlLkF3YWl0aW5nQ3ljbGUzRGF0YVN0YXRlKGEOYoWzg9oCAANaAAtyZWdpc3RlcmluZ0wAF2F1dGhuU3RhdGVtZW50QXNzZXJ0aW9udAASTGphdmEvbGFuZy9TdHJpbmc7TAAhZW5jcnlwdGVkTWF0Y2hpbmdEYXRhc2V0QXNzZXJ0aW9ucQB+AAF4cgBCdWsuZ292LmlkYS5odWIucG9saWN5LmRvbWFpbi5zdGF0ZS5BYnN0cmFjdEF3YWl0aW5nQ3ljbGUzRGF0YVN0YXRl1G959581SYACAAVMABhpZGVudGl0eVByb3ZpZGVyRW50aXR5SWRxAH4AAUwAEGxldmVsT2ZBc3N1cmFuY2V0AC9MdWsvZ292L2lkYS9odWIvcG9saWN5L2RvbWFpbi9MZXZlbE9mQXNzdXJhbmNlO0wAF21hdGNoaW5nU2VydmljZUVudGl0eUlkcQB+AAFMAAxwZXJzaXN0ZW50SWR0ACtMdWsvZ292L2lkYS9odWIvcG9saWN5L2RvbWFpbi9QZXJzaXN0ZW50SWQ7TAAKcmVsYXlTdGF0ZXEAfgABeHIAKnVrLmdvdi5pZGEuaHViLnBvbGljeS5kb21haW4uQWJzdHJhY3RTdGF0Zb5Jzqv8o1OGAgAHWgAYdHJhbnNhY3Rpb25TdXBwb3J0c0VpZGFzTAAbYXNzZXJ0aW9uQ29uc3VtZXJTZXJ2aWNlVXJpdAAOTGphdmEvbmV0L1VSSTtMABNmb3JjZUF1dGhlbnRpY2F0aW9udAATTGphdmEvbGFuZy9Cb29sZWFuO0wACXJlcXVlc3RJZHEAfgABTAAVcmVxdWVzdElzc3VlckVudGl0eUlkcQB+AAFMABZzZXNzaW9uRXhwaXJ5VGltZXN0YW1wdAAYTG9yZy9qb2RhL3RpbWUvRGF0ZVRpbWU7TAAJc2Vzc2lvbklkdAAoTHVrL2dvdi9pZGEvaHViL3BvbGljeS9kb21haW4vU2Vzc2lvbklkO3hwAHNyAAxqYXZhLm5ldC5VUkmsAXguQ55JqwMAAUwABnN0cmluZ3EAfgABeHB0ABQvZGVmYXVsdC1zZXJ2aWNlLXVyaXhwdAAKcmVxdWVzdC1pZHQAFXRyYW5zYWN0aW9uIGVudGl0eSBpZHNyABZvcmcuam9kYS50aW1lLkRhdGVUaW1luDx4ZGpb3fkCAAB4cgAfb3JnLmpvZGEudGltZS5iYXNlLkJhc2VEYXRlVGltZf//+eFPXS6jAgACSgAHaU1pbGxpc0wAC2lDaHJvbm9sb2d5dAAaTG9yZy9qb2RhL3RpbWUvQ2hyb25vbG9neTt4cAAAAIQ/F6/Ac3IAJ29yZy5qb2RhLnRpbWUuY2hyb25vLklTT0Nocm9ub2xvZ3kkU3R1YqnIEWZxN1AnAwAAeHBzcgAfb3JnLmpvZGEudGltZS5EYXRlVGltZVpvbmUkU3R1YqYvAZp8MhrjAwAAeHB3BQADVVRDeHhzcgAmdWsuZ292LmlkYS5odWIucG9saWN5LmRvbWFpbi5TZXNzaW9uSWTLD80S+omGVgIAAUwACXNlc3Npb25JZHEAfgABeHB0AA9zb21lLXNlc3Npb24taWR0AA1pZHAgZW50aXR5LWlkfnIALXVrLmdvdi5pZGEuaHViLnBvbGljeS5kb21haW4uTGV2ZWxPZkFzc3VyYW5jZQAAAAAAAAAAEgAAeHIADmphdmEubGFuZy5FbnVtAAAAAAAAAAASAAB4cHQAB0xFVkVMXzF0ABdtYXRjaGluZ1NlcnZpY2VFbnRpdHlJZHNyACl1ay5nb3YuaWRhLmh1Yi5wb2xpY3kuZG9tYWluLlBlcnNpc3RlbnRJZMH9Q8TBsHTFAgABTAAGbmFtZUlkcQB+AAF4cHQAD2RlZmF1bHQtbmFtZS1pZHAAdAA2YVBhc3N0aHJvdWdoQXNzZXJ0aW9uKCkuYnVpbGRBdXRoblN0YXRlbWVudEFzc2VydGlvbigpdAAkZW5jcnlwdGVkLW1hdGNoaW5nLWRhdGFzZXQtYXNzZXJ0aW9u",
            expectedState
        );
    }

    @Test
    public void shouldDeserializeUserAccountCreatedState() {
        UserAccountCreatedState expectedState = aUserAccountCreatedState().withSessionId(SESSION_ID).build();
        assertDeserializedForm(
            "rO0ABXNyADp1ay5nb3YuaWRhLmh1Yi5wb2xpY3kuZG9tYWluLnN0YXRlLlVzZXJBY2NvdW50Q3JlYXRlZFN0YXRl8dYIRO2ASroCAAVaAAtyZWdpc3RlcmluZ0wAGGlkZW50aXR5UHJvdmlkZXJFbnRpdHlJZHQAEkxqYXZhL2xhbmcvU3RyaW5nO0wAEGxldmVsT2ZBc3N1cmFuY2V0AC9MdWsvZ292L2lkYS9odWIvcG9saWN5L2RvbWFpbi9MZXZlbE9mQXNzdXJhbmNlO0wAGG1hdGNoaW5nU2VydmljZUFzc2VydGlvbnEAfgABTAAKcmVsYXlTdGF0ZXEAfgABeHIAKnVrLmdvdi5pZGEuaHViLnBvbGljeS5kb21haW4uQWJzdHJhY3RTdGF0Zb5Jzqv8o1OGAgAGWgAYdHJhbnNhY3Rpb25TdXBwb3J0c0VpZGFzTAAbYXNzZXJ0aW9uQ29uc3VtZXJTZXJ2aWNlVXJpdAAOTGphdmEvbmV0L1VSSTtMAAlyZXF1ZXN0SWRxAH4AAUwAFXJlcXVlc3RJc3N1ZXJFbnRpdHlJZHEAfgABTAAWc2Vzc2lvbkV4cGlyeVRpbWVzdGFtcHQAGExvcmcvam9kYS90aW1lL0RhdGVUaW1lO0wACXNlc3Npb25JZHQAKEx1ay9nb3YvaWRhL2h1Yi9wb2xpY3kvZG9tYWluL1Nlc3Npb25JZDt4cABzcgAMamF2YS5uZXQuVVJJrAF4LkOeSasDAAFMAAZzdHJpbmdxAH4AAXhwdAAbaHR0cDovL2Fzc2VydGlvbmNvbnN1bWVydXJpeHQACnJlcXVlc3QtaWR0ABFyZXF1ZXN0IGlzc3VlciBpZHNyABZvcmcuam9kYS50aW1lLkRhdGVUaW1luDx4ZGpb3fkCAAB4cgAfb3JnLmpvZGEudGltZS5iYXNlLkJhc2VEYXRlVGltZf//+eFPXS6jAgACSgAHaU1pbGxpc0wAC2lDaHJvbm9sb2d5dAAaTG9yZy9qb2RhL3RpbWUvQ2hyb25vbG9neTt4cAAAAIQ/F6/Ac3IAJ29yZy5qb2RhLnRpbWUuY2hyb25vLklTT0Nocm9ub2xvZ3kkU3R1YqnIEWZxN1AnAwAAeHBzcgAfb3JnLmpvZGEudGltZS5EYXRlVGltZVpvbmUkU3R1YqYvAZp8MhrjAwAAeHB3BQADVVRDeHhzcgAmdWsuZ292LmlkYS5odWIucG9saWN5LmRvbWFpbi5TZXNzaW9uSWTLD80S+omGVgIAAUwACXNlc3Npb25JZHEAfgABeHB0AA9zb21lLXNlc3Npb24taWQAdAAUaWRlbnRpdHktcHJvdmlkZXItaWR+cgAtdWsuZ292LmlkYS5odWIucG9saWN5LmRvbWFpbi5MZXZlbE9mQXNzdXJhbmNlAAAAAAAAAAASAAB4cgAOamF2YS5sYW5nLkVudW0AAAAAAAAAABIAAHhwdAAHTEVWRUxfMnQAN2FQYXNzdGhyb3VnaEFzc2VydGlvbigpLmJ1aWxkTWF0Y2hpbmdTZXJ2aWNlQXNzZXJ0aW9uKClw",
            expectedState
        );
    }

    @Test
    public void shouldDeserializeMatchingServiceRequestErrorState() {
        MatchingServiceRequestErrorState expectedState = aMatchingServiceRequestErrorState().withSessionId(SESSION_ID).build();
        assertDeserializedForm(
            "rO0ABXNyAEN1ay5nb3YuaWRhLmh1Yi5wb2xpY3kuZG9tYWluLnN0YXRlLk1hdGNoaW5nU2VydmljZVJlcXVlc3RFcnJvclN0YXRlQeUv+Bm3FDwCAAJMABhpZGVudGl0eVByb3ZpZGVyRW50aXR5SWR0ABJMamF2YS9sYW5nL1N0cmluZztMAApyZWxheVN0YXRlcQB+AAF4cgAqdWsuZ292LmlkYS5odWIucG9saWN5LmRvbWFpbi5BYnN0cmFjdFN0YXRlvknOq/yjU4YCAAdaABh0cmFuc2FjdGlvblN1cHBvcnRzRWlkYXNMABthc3NlcnRpb25Db25zdW1lclNlcnZpY2VVcml0AA5MamF2YS9uZXQvVVJJO0wAE2ZvcmNlQXV0aGVudGljYXRpb250ABNMamF2YS9sYW5nL0Jvb2xlYW47TAAJcmVxdWVzdElkcQB+AAFMABVyZXF1ZXN0SXNzdWVyRW50aXR5SWRxAH4AAUwAFnNlc3Npb25FeHBpcnlUaW1lc3RhbXB0ABhMb3JnL2pvZGEvdGltZS9EYXRlVGltZTtMAAlzZXNzaW9uSWR0AChMdWsvZ292L2lkYS9odWIvcG9saWN5L2RvbWFpbi9TZXNzaW9uSWQ7eHAAc3IADGphdmEubmV0LlVSSawBeC5DnkmrAwABTAAGc3RyaW5ncQB+AAF4cHQAFi9kZWZhdWx0LXNlcnZpY2UtaW5kZXh4cHQACXJlcXVlc3RJZHQAD3JlcXVlc3RJc3N1ZXJJZHNyABZvcmcuam9kYS50aW1lLkRhdGVUaW1luDx4ZGpb3fkCAAB4cgAfb3JnLmpvZGEudGltZS5iYXNlLkJhc2VEYXRlVGltZf//+eFPXS6jAgACSgAHaU1pbGxpc0wAC2lDaHJvbm9sb2d5dAAaTG9yZy9qb2RhL3RpbWUvQ2hyb25vbG9neTt4cAAAAIQ/F6/Ac3IAJ29yZy5qb2RhLnRpbWUuY2hyb25vLklTT0Nocm9ub2xvZ3kkU3R1YqnIEWZxN1AnAwAAeHBzcgAfb3JnLmpvZGEudGltZS5EYXRlVGltZVpvbmUkU3R1YqYvAZp8MhrjAwAAeHB3BQADVVRDeHhzcgAmdWsuZ292LmlkYS5odWIucG9saWN5LmRvbWFpbi5TZXNzaW9uSWTLD80S+omGVgIAAUwACXNlc3Npb25JZHEAfgABeHB0AA9zb21lLXNlc3Npb24taWR0ABhpZGVudGl0eVByb3ZpZGVyRW50aXR5SWRw",
            expectedState
        );
    }

    @Test
    public void shouldDeserializeEidasSuccessfulMatchState() {
        EidasSuccessfulMatchState expectedState = anEidasSuccessfulMatchState().withSessionId(SESSION_ID).build();
        assertDeserializedForm(
            "rO0ABXNyADx1ay5nb3YuaWRhLmh1Yi5wb2xpY3kuZG9tYWluLnN0YXRlLkVpZGFzU3VjY2Vzc2Z1bE1hdGNoU3RhdGVqisD7A9VmMgIAAHhyAD91ay5nb3YuaWRhLmh1Yi5wb2xpY3kuZG9tYWluLnN0YXRlLkFic3RyYWN0U3VjY2Vzc2Z1bE1hdGNoU3RhdGVjQC8fs+m4fgIABEwAGGlkZW50aXR5UHJvdmlkZXJFbnRpdHlJZHQAEkxqYXZhL2xhbmcvU3RyaW5nO0wAEGxldmVsT2ZBc3N1cmFuY2V0AC9MdWsvZ292L2lkYS9odWIvcG9saWN5L2RvbWFpbi9MZXZlbE9mQXNzdXJhbmNlO0wAGG1hdGNoaW5nU2VydmljZUFzc2VydGlvbnEAfgACTAAKcmVsYXlTdGF0ZXEAfgACeHIAKnVrLmdvdi5pZGEuaHViLnBvbGljeS5kb21haW4uQWJzdHJhY3RTdGF0Zb5Jzqv8o1OGAgAHWgAYdHJhbnNhY3Rpb25TdXBwb3J0c0VpZGFzTAAbYXNzZXJ0aW9uQ29uc3VtZXJTZXJ2aWNlVXJpdAAOTGphdmEvbmV0L1VSSTtMABNmb3JjZUF1dGhlbnRpY2F0aW9udAATTGphdmEvbGFuZy9Cb29sZWFuO0wACXJlcXVlc3RJZHEAfgACTAAVcmVxdWVzdElzc3VlckVudGl0eUlkcQB+AAJMABZzZXNzaW9uRXhwaXJ5VGltZXN0YW1wdAAYTG9yZy9qb2RhL3RpbWUvRGF0ZVRpbWU7TAAJc2Vzc2lvbklkdAAoTHVrL2dvdi9pZGEvaHViL3BvbGljeS9kb21haW4vU2Vzc2lvbklkO3hwAXNyAAxqYXZhLm5ldC5VUkmsAXguQ55JqwMAAUwABnN0cmluZ3EAfgACeHB0ABtodHRwOi8vYXNzZXJ0aW9uY29uc3VtZXJ1cml4cHQACnJlcXVlc3QtaWR0ABFyZXF1ZXN0IGlzc3VlciBpZHNyABZvcmcuam9kYS50aW1lLkRhdGVUaW1luDx4ZGpb3fkCAAB4cgAfb3JnLmpvZGEudGltZS5iYXNlLkJhc2VEYXRlVGltZf//+eFPXS6jAgACSgAHaU1pbGxpc0wAC2lDaHJvbm9sb2d5dAAaTG9yZy9qb2RhL3RpbWUvQ2hyb25vbG9neTt4cAAAAIQ/F6/Ac3IAJ29yZy5qb2RhLnRpbWUuY2hyb25vLklTT0Nocm9ub2xvZ3kkU3R1YqnIEWZxN1AnAwAAeHBzcgAfb3JnLmpvZGEudGltZS5EYXRlVGltZVpvbmUkU3R1YqYvAZp8MhrjAwAAeHB3BQADVVRDeHhzcgAmdWsuZ292LmlkYS5odWIucG9saWN5LmRvbWFpbi5TZXNzaW9uSWTLD80S+omGVgIAAUwACXNlc3Npb25JZHEAfgACeHB0AA9zb21lLXNlc3Npb24taWR0ABFjb3VudHJ5LWVudGl0eS1pZH5yAC11ay5nb3YuaWRhLmh1Yi5wb2xpY3kuZG9tYWluLkxldmVsT2ZBc3N1cmFuY2UAAAAAAAAAABIAAHhyAA5qYXZhLmxhbmcuRW51bQAAAAAAAAAAEgAAeHB0AAdMRVZFTF8ydAA3YVBhc3N0aHJvdWdoQXNzZXJ0aW9uKCkuYnVpbGRNYXRjaGluZ1NlcnZpY2VBc3NlcnRpb24oKXQAC3JlbGF5IHN0YXRl",
            expectedState
        );
    }

    @Test
    public void shouldDeserializeSuccessfulMatchState() {
        SuccessfulMatchState expectedState = aSuccessfulMatchState().withSessionId(SESSION_ID).build();
        assertDeserializedForm(
            "rO0ABXNyADd1ay5nb3YuaWRhLmh1Yi5wb2xpY3kuZG9tYWluLnN0YXRlLlN1Y2Nlc3NmdWxNYXRjaFN0YXRlBVK6QQFZk0YCAAFaAA1pc1JlZ2lzdGVyaW5neHIAP3VrLmdvdi5pZGEuaHViLnBvbGljeS5kb21haW4uc3RhdGUuQWJzdHJhY3RTdWNjZXNzZnVsTWF0Y2hTdGF0ZWNALx+z6bh+AgAETAAYaWRlbnRpdHlQcm92aWRlckVudGl0eUlkdAASTGphdmEvbGFuZy9TdHJpbmc7TAAQbGV2ZWxPZkFzc3VyYW5jZXQAL0x1ay9nb3YvaWRhL2h1Yi9wb2xpY3kvZG9tYWluL0xldmVsT2ZBc3N1cmFuY2U7TAAYbWF0Y2hpbmdTZXJ2aWNlQXNzZXJ0aW9ucQB+AAJMAApyZWxheVN0YXRlcQB+AAJ4cgAqdWsuZ292LmlkYS5odWIucG9saWN5LmRvbWFpbi5BYnN0cmFjdFN0YXRlvknOq/yjU4YCAAdaABh0cmFuc2FjdGlvblN1cHBvcnRzRWlkYXNMABthc3NlcnRpb25Db25zdW1lclNlcnZpY2VVcml0AA5MamF2YS9uZXQvVVJJO0wAE2ZvcmNlQXV0aGVudGljYXRpb250ABNMamF2YS9sYW5nL0Jvb2xlYW47TAAJcmVxdWVzdElkcQB+AAJMABVyZXF1ZXN0SXNzdWVyRW50aXR5SWRxAH4AAkwAFnNlc3Npb25FeHBpcnlUaW1lc3RhbXB0ABhMb3JnL2pvZGEvdGltZS9EYXRlVGltZTtMAAlzZXNzaW9uSWR0AChMdWsvZ292L2lkYS9odWIvcG9saWN5L2RvbWFpbi9TZXNzaW9uSWQ7eHAAc3IADGphdmEubmV0LlVSSawBeC5DnkmrAwABTAAGc3RyaW5ncQB+AAJ4cHQAG2h0dHA6Ly9hc3NlcnRpb25jb25zdW1lcnVyaXhwdAAKcmVxdWVzdC1pZHQAEXJlcXVlc3QgaXNzdWVyIGlkc3IAFm9yZy5qb2RhLnRpbWUuRGF0ZVRpbWW4PHhkalvd+QIAAHhyAB9vcmcuam9kYS50aW1lLmJhc2UuQmFzZURhdGVUaW1l///54U9dLqMCAAJKAAdpTWlsbGlzTAALaUNocm9ub2xvZ3l0ABpMb3JnL2pvZGEvdGltZS9DaHJvbm9sb2d5O3hwAAAAhD8Xr8BzcgAnb3JnLmpvZGEudGltZS5jaHJvbm8uSVNPQ2hyb25vbG9neSRTdHViqcgRZnE3UCcDAAB4cHNyAB9vcmcuam9kYS50aW1lLkRhdGVUaW1lWm9uZSRTdHVipi8BmnwyGuMDAAB4cHcFAANVVEN4eHNyACZ1ay5nb3YuaWRhLmh1Yi5wb2xpY3kuZG9tYWluLlNlc3Npb25JZMsPzRL6iYZWAgABTAAJc2Vzc2lvbklkcQB+AAJ4cHQAD3NvbWUtc2Vzc2lvbi1pZHQADWlkcC1lbnRpdHktaWR+cgAtdWsuZ292LmlkYS5odWIucG9saWN5LmRvbWFpbi5MZXZlbE9mQXNzdXJhbmNlAAAAAAAAAAASAAB4cgAOamF2YS5sYW5nLkVudW0AAAAAAAAAABIAAHhwdAAHTEVWRUxfMnQAN2FQYXNzdGhyb3VnaEFzc2VydGlvbigpLmJ1aWxkTWF0Y2hpbmdTZXJ2aWNlQXNzZXJ0aW9uKCl0AAtyZWxheSBzdGF0ZQA=",
            expectedState
        );
    }

    @Test
    public void shouldDeserializeNoMatchState() {
        NoMatchState expectedState = aNoMatchState().build();
        assertDeserializedForm(
            "rO0ABXNyAC91ay5nb3YuaWRhLmh1Yi5wb2xpY3kuZG9tYWluLnN0YXRlLk5vTWF0Y2hTdGF0ZTsRwSihubXoAgACTAAYaWRlbnRpdHlQcm92aWRlckVudGl0eUlkdAASTGphdmEvbGFuZy9TdHJpbmc7TAAKcmVsYXlTdGF0ZXEAfgABeHIAKnVrLmdvdi5pZGEuaHViLnBvbGljeS5kb21haW4uQWJzdHJhY3RTdGF0Zb5Jzqv8o1OGAgAHWgAYdHJhbnNhY3Rpb25TdXBwb3J0c0VpZGFzTAAbYXNzZXJ0aW9uQ29uc3VtZXJTZXJ2aWNlVXJpdAAOTGphdmEvbmV0L1VSSTtMABNmb3JjZUF1dGhlbnRpY2F0aW9udAATTGphdmEvbGFuZy9Cb29sZWFuO0wACXJlcXVlc3RJZHEAfgABTAAVcmVxdWVzdElzc3VlckVudGl0eUlkcQB+AAFMABZzZXNzaW9uRXhwaXJ5VGltZXN0YW1wdAAYTG9yZy9qb2RhL3RpbWUvRGF0ZVRpbWU7TAAJc2Vzc2lvbklkdAAoTHVrL2dvdi9pZGEvaHViL3BvbGljeS9kb21haW4vU2Vzc2lvbklkO3hwAHNyAAxqYXZhLm5ldC5VUkmsAXguQ55JqwMAAUwABnN0cmluZ3EAfgABeHB0AAgvc29tZVVyaXhwdAAKcmVxdWVzdCBJRHQAD3JlcXVlc3RJc3N1ZXJJZHNyABZvcmcuam9kYS50aW1lLkRhdGVUaW1luDx4ZGpb3fkCAAB4cgAfb3JnLmpvZGEudGltZS5iYXNlLkJhc2VEYXRlVGltZf//+eFPXS6jAgACSgAHaU1pbGxpc0wAC2lDaHJvbm9sb2d5dAAaTG9yZy9qb2RhL3RpbWUvQ2hyb25vbG9neTt4cAAAAIQ/F6/Ac3IAJ29yZy5qb2RhLnRpbWUuY2hyb25vLklTT0Nocm9ub2xvZ3kkU3R1YqnIEWZxN1AnAwAAeHBzcgAfb3JnLmpvZGEudGltZS5EYXRlVGltZVpvbmUkU3R1YqYvAZp8MhrjAwAAeHB3BQADVVRDeHhzcgAmdWsuZ292LmlkYS5odWIucG9saWN5LmRvbWFpbi5TZXNzaW9uSWTLD80S+omGVgIAAUwACXNlc3Npb25JZHEAfgABeHB0AAlzZXNzaW9uSWR0AA1pZHAgZW50aXR5IGlkcA==",
            expectedState
        );
    }

    @Test
    public void shouldDeserializeUserAccountCreationFailedState() {
        UserAccountCreationFailedState expectedState = aUserAccountCreationFailedState().withSessionId(SESSION_ID).build();
        assertDeserializedForm(
            "rO0ABXNyAEF1ay5nb3YuaWRhLmh1Yi5wb2xpY3kuZG9tYWluLnN0YXRlLlVzZXJBY2NvdW50Q3JlYXRpb25GYWlsZWRTdGF0ZTAL7TK/TZ0iAgAAeHIASXVrLmdvdi5pZGEuaHViLnBvbGljeS5kb21haW4uc3RhdGUuQWJzdHJhY3RVc2VyQWNjb3VudENyZWF0aW9uRmFpbGVkU3RhdGUTQ2boRA+vAwIAAUwACnJlbGF5U3RhdGV0ABJMamF2YS9sYW5nL1N0cmluZzt4cgAqdWsuZ292LmlkYS5odWIucG9saWN5LmRvbWFpbi5BYnN0cmFjdFN0YXRlvknOq/yjU4YCAAdaABh0cmFuc2FjdGlvblN1cHBvcnRzRWlkYXNMABthc3NlcnRpb25Db25zdW1lclNlcnZpY2VVcml0AA5MamF2YS9uZXQvVVJJO0wAE2ZvcmNlQXV0aGVudGljYXRpb250ABNMamF2YS9sYW5nL0Jvb2xlYW47TAAJcmVxdWVzdElkcQB+AAJMABVyZXF1ZXN0SXNzdWVyRW50aXR5SWRxAH4AAkwAFnNlc3Npb25FeHBpcnlUaW1lc3RhbXB0ABhMb3JnL2pvZGEvdGltZS9EYXRlVGltZTtMAAlzZXNzaW9uSWR0AChMdWsvZ292L2lkYS9odWIvcG9saWN5L2RvbWFpbi9TZXNzaW9uSWQ7eHAAc3IADGphdmEubmV0LlVSSawBeC5DnkmrAwABTAAGc3RyaW5ncQB+AAJ4cHQAFi9kZWZhdWx0LXNlcnZpY2UtaW5kZXh4cHQACXJlcXVlc3RJZHQAD3JlcXVlc3RJc3N1ZXJJZHNyABZvcmcuam9kYS50aW1lLkRhdGVUaW1luDx4ZGpb3fkCAAB4cgAfb3JnLmpvZGEudGltZS5iYXNlLkJhc2VEYXRlVGltZf//+eFPXS6jAgACSgAHaU1pbGxpc0wAC2lDaHJvbm9sb2d5dAAaTG9yZy9qb2RhL3RpbWUvQ2hyb25vbG9neTt4cAAAAIQ/F6/Ac3IAJ29yZy5qb2RhLnRpbWUuY2hyb25vLklTT0Nocm9ub2xvZ3kkU3R1YqnIEWZxN1AnAwAAeHBzcgAfb3JnLmpvZGEudGltZS5EYXRlVGltZVpvbmUkU3R1YqYvAZp8MhrjAwAAeHB3BQADVVRDeHhzcgAmdWsuZ292LmlkYS5odWIucG9saWN5LmRvbWFpbi5TZXNzaW9uSWTLD80S+omGVgIAAUwACXNlc3Npb25JZHEAfgACeHB0AA9zb21lLXNlc3Npb24taWR0AApyZWxheVN0YXRl",
            expectedState
        );
    }

    @Test
    public void shouldDeserializeEidasUserAccountCreationFailedState() {
        EidasUserAccountCreationFailedState expectedState = aEidasUserAccountCreationFailedState().withSessionId(SESSION_ID).build();
        assertDeserializedForm(
            "rO0ABXNyAEZ1ay5nb3YuaWRhLmh1Yi5wb2xpY3kuZG9tYWluLnN0YXRlLkVpZGFzVXNlckFjY291bnRDcmVhdGlvbkZhaWxlZFN0YXRl3HJx+j2itFQCAAB4cgBJdWsuZ292LmlkYS5odWIucG9saWN5LmRvbWFpbi5zdGF0ZS5BYnN0cmFjdFVzZXJBY2NvdW50Q3JlYXRpb25GYWlsZWRTdGF0ZRNDZuhED68DAgABTAAKcmVsYXlTdGF0ZXQAEkxqYXZhL2xhbmcvU3RyaW5nO3hyACp1ay5nb3YuaWRhLmh1Yi5wb2xpY3kuZG9tYWluLkFic3RyYWN0U3RhdGW+Sc6r/KNThgIAB1oAGHRyYW5zYWN0aW9uU3VwcG9ydHNFaWRhc0wAG2Fzc2VydGlvbkNvbnN1bWVyU2VydmljZVVyaXQADkxqYXZhL25ldC9VUkk7TAATZm9yY2VBdXRoZW50aWNhdGlvbnQAE0xqYXZhL2xhbmcvQm9vbGVhbjtMAAlyZXF1ZXN0SWRxAH4AAkwAFXJlcXVlc3RJc3N1ZXJFbnRpdHlJZHEAfgACTAAWc2Vzc2lvbkV4cGlyeVRpbWVzdGFtcHQAGExvcmcvam9kYS90aW1lL0RhdGVUaW1lO0wACXNlc3Npb25JZHQAKEx1ay9nb3YvaWRhL2h1Yi9wb2xpY3kvZG9tYWluL1Nlc3Npb25JZDt4cAFzcgAMamF2YS5uZXQuVVJJrAF4LkOeSasDAAFMAAZzdHJpbmdxAH4AAnhwdAAWL2RlZmF1bHQtc2VydmljZS1pbmRleHhzcgARamF2YS5sYW5nLkJvb2xlYW7NIHKA1Zz67gIAAVoABXZhbHVleHAAdAAJcmVxdWVzdElkdAAPcmVxdWVzdElzc3Vlcklkc3IAFm9yZy5qb2RhLnRpbWUuRGF0ZVRpbWW4PHhkalvd+QIAAHhyAB9vcmcuam9kYS50aW1lLmJhc2UuQmFzZURhdGVUaW1l///54U9dLqMCAAJKAAdpTWlsbGlzTAALaUNocm9ub2xvZ3l0ABpMb3JnL2pvZGEvdGltZS9DaHJvbm9sb2d5O3hwAAAAhD8Xr8BzcgAnb3JnLmpvZGEudGltZS5jaHJvbm8uSVNPQ2hyb25vbG9neSRTdHViqcgRZnE3UCcDAAB4cHNyAB9vcmcuam9kYS50aW1lLkRhdGVUaW1lWm9uZSRTdHVipi8BmnwyGuMDAAB4cHcFAANVVEN4eHNyACZ1ay5nb3YuaWRhLmh1Yi5wb2xpY3kuZG9tYWluLlNlc3Npb25JZMsPzRL6iYZWAgABTAAJc2Vzc2lvbklkcQB+AAJ4cHQAD3NvbWUtc2Vzc2lvbi1pZHA=",
            expectedState
        );
    }

    @Test
    public void shouldDeserializeIdpSelectedState() {
        IdpSelectedState expectedState = anIdpSelectedState().withSessionId(SESSION_ID).withRequestId(REQUEST_ID).build();
        assertDeserializedForm(
            "rO0ABXNyADN1ay5nb3YuaWRhLmh1Yi5wb2xpY3kuZG9tYWluLnN0YXRlLklkcFNlbGVjdGVkU3RhdGXYbfTHW+3FwQIACVoAC3JlZ2lzdGVyaW5nTAAaYXZhaWxhYmxlSWRlbnRpdHlQcm92aWRlcnN0ABBMamF2YS91dGlsL0xpc3Q7TAATZm9yY2VBdXRoZW50aWNhdGlvbnQAE0xqYXZhL2xhbmcvQm9vbGVhbjtMAAtpZHBFbnRpdHlJZHQAEkxqYXZhL2xhbmcvU3RyaW5nO0wAEWxldmVsc09mQXNzdXJhbmNlcQB+AAFMABdtYXRjaGluZ1NlcnZpY2VFbnRpdHlJZHEAfgADTAAKcmVsYXlTdGF0ZXEAfgADTAAMcmVxdWVzdGVkTG9hdAAvTHVrL2dvdi9pZGEvaHViL3BvbGljeS9kb21haW4vTGV2ZWxPZkFzc3VyYW5jZTtMABZ1c2VFeGFjdENvbXBhcmlzb25UeXBlcQB+AAJ4cgAqdWsuZ292LmlkYS5odWIucG9saWN5LmRvbWFpbi5BYnN0cmFjdFN0YXRlvknOq/yjU4YCAAZaABh0cmFuc2FjdGlvblN1cHBvcnRzRWlkYXNMABthc3NlcnRpb25Db25zdW1lclNlcnZpY2VVcml0AA5MamF2YS9uZXQvVVJJO0wACXJlcXVlc3RJZHEAfgADTAAVcmVxdWVzdElzc3VlckVudGl0eUlkcQB+AANMABZzZXNzaW9uRXhwaXJ5VGltZXN0YW1wdAAYTG9yZy9qb2RhL3RpbWUvRGF0ZVRpbWU7TAAJc2Vzc2lvbklkdAAoTHVrL2dvdi9pZGEvaHViL3BvbGljeS9kb21haW4vU2Vzc2lvbklkO3hwAHNyAAxqYXZhLm5ldC5VUkmsAXguQ55JqwMAAUwABnN0cmluZ3EAfgADeHB0ABQvZGVmYXVsdC1zZXJ2aWNlLXVyaXh0AA9zb21lLXJlcXVlc3QtaWR0ABV0cmFuc2FjdGlvbi1lbnRpdHktaWRzcgAWb3JnLmpvZGEudGltZS5EYXRlVGltZbg8eGRqW935AgAAeHIAH29yZy5qb2RhLnRpbWUuYmFzZS5CYXNlRGF0ZVRpbWX///nhT10uowIAAkoAB2lNaWxsaXNMAAtpQ2hyb25vbG9neXQAGkxvcmcvam9kYS90aW1lL0Nocm9ub2xvZ3k7eHAAAACEWM5UAHNyACdvcmcuam9kYS50aW1lLmNocm9uby5JU09DaHJvbm9sb2d5JFN0dWKpyBFmcTdQJwMAAHhwc3IAH29yZy5qb2RhLnRpbWUuRGF0ZVRpbWVab25lJFN0dWKmLwGafDIa4wMAAHhwdwUAA1VUQ3h4c3IAJnVrLmdvdi5pZGEuaHViLnBvbGljeS5kb21haW4uU2Vzc2lvbklkyw/NEvqJhlYCAAFMAAlzZXNzaW9uSWRxAH4AA3hwdAAPc29tZS1zZXNzaW9uLWlkAHNyADZjb20uZ29vZ2xlLmNvbW1vbi5jb2xsZWN0LkltbXV0YWJsZUxpc3QkU2VyaWFsaXplZEZvcm0AAAAAAAAAAAIAAVsACGVsZW1lbnRzdAATW0xqYXZhL2xhbmcvT2JqZWN0O3hwdXIAE1tMamF2YS5sYW5nLk9iamVjdDuQzlifEHMpbAIAAHhwAAAAA3QABWlkcC1hdAAFaWRwLWJ0AAVpZHAtY3B0AA1pZHAtZW50aXR5LWlkc3IAGmphdmEudXRpbC5BcnJheXMkQXJyYXlMaXN02aQ8vs2IBtICAAFbAAFhcQB+ABt4cHVyADBbTHVrLmdvdi5pZGEuaHViLnBvbGljeS5kb21haW4uTGV2ZWxPZkFzc3VyYW5jZTsbD8ZrfoczoAIAAHhwAAAAAn5yAC11ay5nb3YuaWRhLmh1Yi5wb2xpY3kuZG9tYWluLkxldmVsT2ZBc3N1cmFuY2UAAAAAAAAAABIAAHhyAA5qYXZhLmxhbmcuRW51bQAAAAAAAAAAEgAAeHB0AAdMRVZFTF8xfnEAfgAndAAHTEVWRUxfMnQAGm1hdGNoaW5nLXNlcnZpY2UtZW50aXR5LWlkcHEAfgArc3IAEWphdmEubGFuZy5Cb29sZWFuzSBygNWc+u4CAAFaAAV2YWx1ZXhwAA==",
            expectedState
        );
    }

    @Test
    public void shouldDeserializeRequesterErrorState() {
        RequesterErrorState expectedState = aRequesterErrorState().withSessionId(SESSION_ID).build();
        assertDeserializedForm(
            "rO0ABXNyADZ1ay5nb3YuaWRhLmh1Yi5wb2xpY3kuZG9tYWluLnN0YXRlLlJlcXVlc3RlckVycm9yU3RhdGXn30uHwU1kfQIAAUwACnJlbGF5U3RhdGV0ABJMamF2YS9sYW5nL1N0cmluZzt4cgAqdWsuZ292LmlkYS5odWIucG9saWN5LmRvbWFpbi5BYnN0cmFjdFN0YXRlvknOq/yjU4YCAAdaABh0cmFuc2FjdGlvblN1cHBvcnRzRWlkYXNMABthc3NlcnRpb25Db25zdW1lclNlcnZpY2VVcml0AA5MamF2YS9uZXQvVVJJO0wAE2ZvcmNlQXV0aGVudGljYXRpb250ABNMamF2YS9sYW5nL0Jvb2xlYW47TAAJcmVxdWVzdElkcQB+AAFMABVyZXF1ZXN0SXNzdWVyRW50aXR5SWRxAH4AAUwAFnNlc3Npb25FeHBpcnlUaW1lc3RhbXB0ABhMb3JnL2pvZGEvdGltZS9EYXRlVGltZTtMAAlzZXNzaW9uSWR0AChMdWsvZ292L2lkYS9odWIvcG9saWN5L2RvbWFpbi9TZXNzaW9uSWQ7eHAAc3IADGphdmEubmV0LlVSSawBeC5DnkmrAwABTAAGc3RyaW5ncQB+AAF4cHQAG2Fzc2VydGlvbkNvbnN1bWVyU2VydmljZVVyaXhzcgARamF2YS5sYW5nLkJvb2xlYW7NIHKA1Zz67gIAAVoABXZhbHVleHAAdAAJcmVxdWVzdElkdAAaYXV0aG5SZXF1ZXN0SXNzdWVyRW50aXR5SWRzcgAWb3JnLmpvZGEudGltZS5EYXRlVGltZbg8eGRqW935AgAAeHIAH29yZy5qb2RhLnRpbWUuYmFzZS5CYXNlRGF0ZVRpbWX///nhT10uowIAAkoAB2lNaWxsaXNMAAtpQ2hyb25vbG9neXQAGkxvcmcvam9kYS90aW1lL0Nocm9ub2xvZ3k7eHAAAACEP0V2gHNyACdvcmcuam9kYS50aW1lLmNocm9uby5JU09DaHJvbm9sb2d5JFN0dWKpyBFmcTdQJwMAAHhwc3IAH29yZy5qb2RhLnRpbWUuRGF0ZVRpbWVab25lJFN0dWKmLwGafDIa4wMAAHhwdwUAA1VUQ3h4c3IAJnVrLmdvdi5pZGEuaHViLnBvbGljeS5kb21haW4uU2Vzc2lvbklkyw/NEvqJhlYCAAFMAAlzZXNzaW9uSWRxAH4AAXhwdAAPc29tZS1zZXNzaW9uLWlkdAAKcmVsYXlTdGF0ZQ==",
            expectedState
        );
    }

    @Test
    public void shouldDeserializeCycle3DataInputCancelledState() {
        Cycle3DataInputCancelledState expectedState = aCycle3DataInputCancelledState().withSessionId(SESSION_ID).withRequestId(REQUEST_ID).build();
        assertDeserializedForm(
            "rO0ABXNyAEB1ay5nb3YuaWRhLmh1Yi5wb2xpY3kuZG9tYWluLnN0YXRlLkN5Y2xlM0RhdGFJbnB1dENhbmNlbGxlZFN0YXRlfSHeG1g3CBgCAAFMAApyZWxheVN0YXRldAASTGphdmEvbGFuZy9TdHJpbmc7eHIAKnVrLmdvdi5pZGEuaHViLnBvbGljeS5kb21haW4uQWJzdHJhY3RTdGF0Zb5Jzqv8o1OGAgAHWgAYdHJhbnNhY3Rpb25TdXBwb3J0c0VpZGFzTAAbYXNzZXJ0aW9uQ29uc3VtZXJTZXJ2aWNlVXJpdAAOTGphdmEvbmV0L1VSSTtMABNmb3JjZUF1dGhlbnRpY2F0aW9udAATTGphdmEvbGFuZy9Cb29sZWFuO0wACXJlcXVlc3RJZHEAfgABTAAVcmVxdWVzdElzc3VlckVudGl0eUlkcQB+AAFMABZzZXNzaW9uRXhwaXJ5VGltZXN0YW1wdAAYTG9yZy9qb2RhL3RpbWUvRGF0ZVRpbWU7TAAJc2Vzc2lvbklkdAAoTHVrL2dvdi9pZGEvaHViL3BvbGljeS9kb21haW4vU2Vzc2lvbklkO3hwAHNyAAxqYXZhLm5ldC5VUkmsAXguQ55JqwMAAUwABnN0cmluZ3EAfgABeHB0ABYvZGVmYXVsdC1zZXJ2aWNlLWluZGV4eHB0AA9zb21lLXJlcXVlc3QtaWR0AA9yZXF1ZXN0SXNzdWVySWRzcgAWb3JnLmpvZGEudGltZS5EYXRlVGltZbg8eGRqW935AgAAeHIAH29yZy5qb2RhLnRpbWUuYmFzZS5CYXNlRGF0ZVRpbWX///nhT10uowIAAkoAB2lNaWxsaXNMAAtpQ2hyb25vbG9neXQAGkxvcmcvam9kYS90aW1lL0Nocm9ub2xvZ3k7eHAAAACEPxevwHNyACdvcmcuam9kYS50aW1lLmNocm9uby5JU09DaHJvbm9sb2d5JFN0dWKpyBFmcTdQJwMAAHhwc3IAH29yZy5qb2RhLnRpbWUuRGF0ZVRpbWVab25lJFN0dWKmLwGafDIa4wMAAHhwdwUAA1VUQ3h4c3IAJnVrLmdvdi5pZGEuaHViLnBvbGljeS5kb21haW4uU2Vzc2lvbklkyw/NEvqJhlYCAAFMAAlzZXNzaW9uSWRxAH4AAXhwdAAPc29tZS1zZXNzaW9uLWlkcA==",
            expectedState
        );
    }

    @Test
    public void shouldDeserializeEidasCycle0And1MatchRequestSentState() {
        EidasCycle0And1MatchRequestSentState expectedState = anEidasCycle0And1MatchRequestSentState().build();
        assertDeserializedForm(
            "rO0ABXNyAEd1ay5nb3YuaWRhLmh1Yi5wb2xpY3kuZG9tYWluLnN0YXRlLkVpZGFzQ3ljbGUwQW5kMU1hdGNoUmVxdWVzdFNlbnRTdGF0ZbJ9YMbNjjvcAgACTAAaZW5jcnlwdGVkSWRlbnRpdHlBc3NlcnRpb250ABJMamF2YS9sYW5nL1N0cmluZztMAAxwZXJzaXN0ZW50SWR0ACtMdWsvZ292L2lkYS9odWIvcG9saWN5L2RvbWFpbi9QZXJzaXN0ZW50SWQ7eHIAPXVrLmdvdi5pZGEuaHViLnBvbGljeS5kb21haW4uc3RhdGUuRWlkYXNNYXRjaFJlcXVlc3RTZW50U3RhdGX9axjYcivYYwIAAHhyAEB1ay5nb3YuaWRhLmh1Yi5wb2xpY3kuZG9tYWluLnN0YXRlLkFic3RyYWN0TWF0Y2hSZXF1ZXN0U2VudFN0YXRl0xq6XMx9pY4CAAVMABhpZGVudGl0eVByb3ZpZGVyRW50aXR5SWRxAH4AAUwAE2lkcExldmVsT2ZBc3N1cmFuY2V0AC9MdWsvZ292L2lkYS9odWIvcG9saWN5L2RvbWFpbi9MZXZlbE9mQXNzdXJhbmNlO0wAHm1hdGNoaW5nU2VydmljZUFkYXB0ZXJFbnRpdHlJZHEAfgABTAAKcmVsYXlTdGF0ZXEAfgABTAAPcmVxdWVzdFNlbnRUaW1ldAAYTG9yZy9qb2RhL3RpbWUvRGF0ZVRpbWU7eHIAKnVrLmdvdi5pZGEuaHViLnBvbGljeS5kb21haW4uQWJzdHJhY3RTdGF0Zb5Jzqv8o1OGAgAHWgAYdHJhbnNhY3Rpb25TdXBwb3J0c0VpZGFzTAAbYXNzZXJ0aW9uQ29uc3VtZXJTZXJ2aWNlVXJpdAAOTGphdmEvbmV0L1VSSTtMABNmb3JjZUF1dGhlbnRpY2F0aW9udAATTGphdmEvbGFuZy9Cb29sZWFuO0wACXJlcXVlc3RJZHEAfgABTAAVcmVxdWVzdElzc3VlckVudGl0eUlkcQB+AAFMABZzZXNzaW9uRXhwaXJ5VGltZXN0YW1wcQB+AAZMAAlzZXNzaW9uSWR0AChMdWsvZ292L2lkYS9odWIvcG9saWN5L2RvbWFpbi9TZXNzaW9uSWQ7eHABc3IADGphdmEubmV0LlVSSawBeC5DnkmrAwABTAAGc3RyaW5ncQB+AAF4cHQAG2Fzc2VydGlvbkNvbnN1bWVyU2VydmljZVVyaXhzcgARamF2YS5sYW5nLkJvb2xlYW7NIHKA1Zz67gIAAVoABXZhbHVleHAAdAAJcmVxdWVzdElkdAAPcmVxdWVzdElzc3Vlcklkc3IAFm9yZy5qb2RhLnRpbWUuRGF0ZVRpbWW4PHhkalvd+QIAAHhyAB9vcmcuam9kYS50aW1lLmJhc2UuQmFzZURhdGVUaW1l///54U9dLqMCAAJKAAdpTWlsbGlzTAALaUNocm9ub2xvZ3l0ABpMb3JnL2pvZGEvdGltZS9DaHJvbm9sb2d5O3hwAAAAhD8Xr8BzcgAnb3JnLmpvZGEudGltZS5jaHJvbm8uSVNPQ2hyb25vbG9neSRTdHViqcgRZnE3UCcDAAB4cHNyAB9vcmcuam9kYS50aW1lLkRhdGVUaW1lWm9uZSRTdHVipi8BmnwyGuMDAAB4cHcFAANVVEN4eHNyACZ1ay5nb3YuaWRhLmh1Yi5wb2xpY3kuZG9tYWluLlNlc3Npb25JZMsPzRL6iYZWAgABTAAJc2Vzc2lvbklkcQB+AAF4cHQACXNlc3Npb25JZHQAGGlkZW50aXR5UHJvdmlkZXJFbnRpdHlJZH5yAC11ay5nb3YuaWRhLmh1Yi5wb2xpY3kuZG9tYWluLkxldmVsT2ZBc3N1cmFuY2UAAAAAAAAAABIAAHhyAA5qYXZhLmxhbmcuRW51bQAAAAAAAAAAEgAAeHB0AAdMRVZFTF8ydAAebWF0Y2hpbmdTZXJ2aWNlQWRhcHRlckVudGl0eUlkcHNxAH4AEwAAAIQ/DogAcQB+ABh0ABplbmNyeXB0ZWRJZGVudGl0eUFzc2VydGlvbnNyACl1ay5nb3YuaWRhLmh1Yi5wb2xpY3kuZG9tYWluLlBlcnNpc3RlbnRJZMH9Q8TBsHTFAgABTAAGbmFtZUlkcQB+AAF4cHQAD2RlZmF1bHQtbmFtZS1pZA==",
            expectedState
        );
    }

    @Test
    public void shouldDeserializeEidasCycle3MatchRequestSentState() {
        EidasCycle3MatchRequestSentState expectedState = anEidasCycle3MatchRequestSentState().build();
        assertDeserializedForm(
            "rO0ABXNyAEN1ay5nb3YuaWRhLmh1Yi5wb2xpY3kuZG9tYWluLnN0YXRlLkVpZGFzQ3ljbGUzTWF0Y2hSZXF1ZXN0U2VudFN0YXRlfDjB9OB4Z5kCAAB4cgBHdWsuZ292LmlkYS5odWIucG9saWN5LmRvbWFpbi5zdGF0ZS5FaWRhc0N5Y2xlMEFuZDFNYXRjaFJlcXVlc3RTZW50U3RhdGWyfWDGzY473AIAAkwAGmVuY3J5cHRlZElkZW50aXR5QXNzZXJ0aW9udAASTGphdmEvbGFuZy9TdHJpbmc7TAAMcGVyc2lzdGVudElkdAArTHVrL2dvdi9pZGEvaHViL3BvbGljeS9kb21haW4vUGVyc2lzdGVudElkO3hyAD11ay5nb3YuaWRhLmh1Yi5wb2xpY3kuZG9tYWluLnN0YXRlLkVpZGFzTWF0Y2hSZXF1ZXN0U2VudFN0YXRl/WsY2HIr2GMCAAB4cgBAdWsuZ292LmlkYS5odWIucG9saWN5LmRvbWFpbi5zdGF0ZS5BYnN0cmFjdE1hdGNoUmVxdWVzdFNlbnRTdGF0ZdMaulzMfaWOAgAFTAAYaWRlbnRpdHlQcm92aWRlckVudGl0eUlkcQB+AAJMABNpZHBMZXZlbE9mQXNzdXJhbmNldAAvTHVrL2dvdi9pZGEvaHViL3BvbGljeS9kb21haW4vTGV2ZWxPZkFzc3VyYW5jZTtMAB5tYXRjaGluZ1NlcnZpY2VBZGFwdGVyRW50aXR5SWRxAH4AAkwACnJlbGF5U3RhdGVxAH4AAkwAD3JlcXVlc3RTZW50VGltZXQAGExvcmcvam9kYS90aW1lL0RhdGVUaW1lO3hyACp1ay5nb3YuaWRhLmh1Yi5wb2xpY3kuZG9tYWluLkFic3RyYWN0U3RhdGW+Sc6r/KNThgIAB1oAGHRyYW5zYWN0aW9uU3VwcG9ydHNFaWRhc0wAG2Fzc2VydGlvbkNvbnN1bWVyU2VydmljZVVyaXQADkxqYXZhL25ldC9VUkk7TAATZm9yY2VBdXRoZW50aWNhdGlvbnQAE0xqYXZhL2xhbmcvQm9vbGVhbjtMAAlyZXF1ZXN0SWRxAH4AAkwAFXJlcXVlc3RJc3N1ZXJFbnRpdHlJZHEAfgACTAAWc2Vzc2lvbkV4cGlyeVRpbWVzdGFtcHEAfgAHTAAJc2Vzc2lvbklkdAAoTHVrL2dvdi9pZGEvaHViL3BvbGljeS9kb21haW4vU2Vzc2lvbklkO3hwAXNyAAxqYXZhLm5ldC5VUkmsAXguQ55JqwMAAUwABnN0cmluZ3EAfgACeHB0ABthc3NlcnRpb25Db25zdW1lclNlcnZpY2VVcml4c3IAEWphdmEubGFuZy5Cb29sZWFuzSBygNWc+u4CAAFaAAV2YWx1ZXhwAHQACXJlcXVlc3RJZHQAD3JlcXVlc3RJc3N1ZXJJZHNyABZvcmcuam9kYS50aW1lLkRhdGVUaW1luDx4ZGpb3fkCAAB4cgAfb3JnLmpvZGEudGltZS5iYXNlLkJhc2VEYXRlVGltZf//+eFPXS6jAgACSgAHaU1pbGxpc0wAC2lDaHJvbm9sb2d5dAAaTG9yZy9qb2RhL3RpbWUvQ2hyb25vbG9neTt4cAAAAIQ/F6/Ac3IAJ29yZy5qb2RhLnRpbWUuY2hyb25vLklTT0Nocm9ub2xvZ3kkU3R1YqnIEWZxN1AnAwAAeHBzcgAfb3JnLmpvZGEudGltZS5EYXRlVGltZVpvbmUkU3R1YqYvAZp8MhrjAwAAeHB3BQADVVRDeHhzcgAmdWsuZ292LmlkYS5odWIucG9saWN5LmRvbWFpbi5TZXNzaW9uSWTLD80S+omGVgIAAUwACXNlc3Npb25JZHEAfgACeHB0AAlzZXNzaW9uSWR0ABhpZGVudGl0eVByb3ZpZGVyRW50aXR5SWR+cgAtdWsuZ292LmlkYS5odWIucG9saWN5LmRvbWFpbi5MZXZlbE9mQXNzdXJhbmNlAAAAAAAAAAASAAB4cgAOamF2YS5sYW5nLkVudW0AAAAAAAAAABIAAHhwdAAHTEVWRUxfMnQAHm1hdGNoaW5nU2VydmljZUFkYXB0ZXJFbnRpdHlJZHBzcQB+ABQAAACEPw6IAHEAfgAZdAAaZW5jcnlwdGVkSWRlbnRpdHlBc3NlcnRpb25zcgApdWsuZ292LmlkYS5odWIucG9saWN5LmRvbWFpbi5QZXJzaXN0ZW50SWTB/UPEwbB0xQIAAUwABm5hbWVJZHEAfgACeHB0AA9kZWZhdWx0LW5hbWUtaWQ=",
            expectedState
        );
    }

    @Test
    public void shouldDeserializeUserAccountCreationRequestSentState() {
        UserAccountCreationRequestSentState expectedState = aUserAccountCreationRequestSentState().withSessionId(SESSION_ID).withRequestId(REQUEST_ID).build();
        assertDeserializedForm(
            "rO0ABXNyAEZ1ay5nb3YuaWRhLmh1Yi5wb2xpY3kuZG9tYWluLnN0YXRlLlVzZXJBY2NvdW50Q3JlYXRpb25SZXF1ZXN0U2VudFN0YXRl1KTcKY+mI0kCAAB4cgA4dWsuZ292LmlkYS5odWIucG9saWN5LmRvbWFpbi5zdGF0ZS5NYXRjaFJlcXVlc3RTZW50U3RhdGXrh+X7kGetYQIAAVoAC3JlZ2lzdGVyaW5neHIAQHVrLmdvdi5pZGEuaHViLnBvbGljeS5kb21haW4uc3RhdGUuQWJzdHJhY3RNYXRjaFJlcXVlc3RTZW50U3RhdGXTGrpczH2ljgIABUwAGGlkZW50aXR5UHJvdmlkZXJFbnRpdHlJZHQAEkxqYXZhL2xhbmcvU3RyaW5nO0wAE2lkcExldmVsT2ZBc3N1cmFuY2V0AC9MdWsvZ292L2lkYS9odWIvcG9saWN5L2RvbWFpbi9MZXZlbE9mQXNzdXJhbmNlO0wAHm1hdGNoaW5nU2VydmljZUFkYXB0ZXJFbnRpdHlJZHEAfgADTAAKcmVsYXlTdGF0ZXEAfgADTAAPcmVxdWVzdFNlbnRUaW1ldAAYTG9yZy9qb2RhL3RpbWUvRGF0ZVRpbWU7eHIAKnVrLmdvdi5pZGEuaHViLnBvbGljeS5kb21haW4uQWJzdHJhY3RTdGF0Zb5Jzqv8o1OGAgAHWgAYdHJhbnNhY3Rpb25TdXBwb3J0c0VpZGFzTAAbYXNzZXJ0aW9uQ29uc3VtZXJTZXJ2aWNlVXJpdAAOTGphdmEvbmV0L1VSSTtMABNmb3JjZUF1dGhlbnRpY2F0aW9udAATTGphdmEvbGFuZy9Cb29sZWFuO0wACXJlcXVlc3RJZHEAfgADTAAVcmVxdWVzdElzc3VlckVudGl0eUlkcQB+AANMABZzZXNzaW9uRXhwaXJ5VGltZXN0YW1wcQB+AAVMAAlzZXNzaW9uSWR0AChMdWsvZ292L2lkYS9odWIvcG9saWN5L2RvbWFpbi9TZXNzaW9uSWQ7eHAAc3IADGphdmEubmV0LlVSSawBeC5DnkmrAwABTAAGc3RyaW5ncQB+AAN4cHQAFi9kZWZhdWx0LXNlcnZpY2UtaW5kZXh4cHQAD3NvbWUtcmVxdWVzdC1pZHQAEXJlcXVlc3QgaXNzdWVyIGlkc3IAFm9yZy5qb2RhLnRpbWUuRGF0ZVRpbWW4PHhkalvd+QIAAHhyAB9vcmcuam9kYS50aW1lLmJhc2UuQmFzZURhdGVUaW1l///54U9dLqMCAAJKAAdpTWlsbGlzTAALaUNocm9ub2xvZ3l0ABpMb3JnL2pvZGEvdGltZS9DaHJvbm9sb2d5O3hwAAAAhD8Xr8BzcgAnb3JnLmpvZGEudGltZS5jaHJvbm8uSVNPQ2hyb25vbG9neSRTdHViqcgRZnE3UCcDAAB4cHNyAB9vcmcuam9kYS50aW1lLkRhdGVUaW1lWm9uZSRTdHVipi8BmnwyGuMDAAB4cHcFAANVVEN4eHNyACZ1ay5nb3YuaWRhLmh1Yi5wb2xpY3kuZG9tYWluLlNlc3Npb25JZMsPzRL6iYZWAgABTAAJc2Vzc2lvbklkcQB+AAN4cHQAD3NvbWUtc2Vzc2lvbi1pZHQADWlkcCBlbnRpdHkgaWR+cgAtdWsuZ292LmlkYS5odWIucG9saWN5LmRvbWFpbi5MZXZlbE9mQXNzdXJhbmNlAAAAAAAAAAASAAB4cgAOamF2YS5sYW5nLkVudW0AAAAAAAAAABIAAHhwdAAHTEVWRUxfMXQAF21hdGNoaW5nU2VydmljZUVudGl0eUlkcHNxAH4AEAAAAIQ/DogAcQB+ABUA",
            expectedState
        );
    }

    @Test
    public void shouldDeserializeEidasUserAccountCreationRequestSentState() {
        EidasUserAccountCreationRequestSentState expectedState = anEidasUserAccountCreationRequestSentState().withSessionId(SESSION_ID).withRequestId(REQUEST_ID).build();
        assertDeserializedForm(
            "rO0ABXNyAEt1ay5nb3YuaWRhLmh1Yi5wb2xpY3kuZG9tYWluLnN0YXRlLkVpZGFzVXNlckFjY291bnRDcmVhdGlvblJlcXVlc3RTZW50U3RhdGXUpNwpj6YjSQIAAHhyAD11ay5nb3YuaWRhLmh1Yi5wb2xpY3kuZG9tYWluLnN0YXRlLkVpZGFzTWF0Y2hSZXF1ZXN0U2VudFN0YXRl/WsY2HIr2GMCAAB4cgBAdWsuZ292LmlkYS5odWIucG9saWN5LmRvbWFpbi5zdGF0ZS5BYnN0cmFjdE1hdGNoUmVxdWVzdFNlbnRTdGF0ZdMaulzMfaWOAgAFTAAYaWRlbnRpdHlQcm92aWRlckVudGl0eUlkdAASTGphdmEvbGFuZy9TdHJpbmc7TAATaWRwTGV2ZWxPZkFzc3VyYW5jZXQAL0x1ay9nb3YvaWRhL2h1Yi9wb2xpY3kvZG9tYWluL0xldmVsT2ZBc3N1cmFuY2U7TAAebWF0Y2hpbmdTZXJ2aWNlQWRhcHRlckVudGl0eUlkcQB+AANMAApyZWxheVN0YXRlcQB+AANMAA9yZXF1ZXN0U2VudFRpbWV0ABhMb3JnL2pvZGEvdGltZS9EYXRlVGltZTt4cgAqdWsuZ292LmlkYS5odWIucG9saWN5LmRvbWFpbi5BYnN0cmFjdFN0YXRlvknOq/yjU4YCAAdaABh0cmFuc2FjdGlvblN1cHBvcnRzRWlkYXNMABthc3NlcnRpb25Db25zdW1lclNlcnZpY2VVcml0AA5MamF2YS9uZXQvVVJJO0wAE2ZvcmNlQXV0aGVudGljYXRpb250ABNMamF2YS9sYW5nL0Jvb2xlYW47TAAJcmVxdWVzdElkcQB+AANMABVyZXF1ZXN0SXNzdWVyRW50aXR5SWRxAH4AA0wAFnNlc3Npb25FeHBpcnlUaW1lc3RhbXBxAH4ABUwACXNlc3Npb25JZHQAKEx1ay9nb3YvaWRhL2h1Yi9wb2xpY3kvZG9tYWluL1Nlc3Npb25JZDt4cAFzcgAMamF2YS5uZXQuVVJJrAF4LkOeSasDAAFMAAZzdHJpbmdxAH4AA3hwdAAWL2RlZmF1bHQtc2VydmljZS1pbmRleHhwdAAPc29tZS1yZXF1ZXN0LWlkdAARcmVxdWVzdCBpc3N1ZXIgaWRzcgAWb3JnLmpvZGEudGltZS5EYXRlVGltZbg8eGRqW935AgAAeHIAH29yZy5qb2RhLnRpbWUuYmFzZS5CYXNlRGF0ZVRpbWX///nhT10uowIAAkoAB2lNaWxsaXNMAAtpQ2hyb25vbG9neXQAGkxvcmcvam9kYS90aW1lL0Nocm9ub2xvZ3k7eHAAAACEPxevwHNyACdvcmcuam9kYS50aW1lLmNocm9uby5JU09DaHJvbm9sb2d5JFN0dWKpyBFmcTdQJwMAAHhwc3IAH29yZy5qb2RhLnRpbWUuRGF0ZVRpbWVab25lJFN0dWKmLwGafDIa4wMAAHhwdwUAA1VUQ3h4c3IAJnVrLmdvdi5pZGEuaHViLnBvbGljeS5kb21haW4uU2Vzc2lvbklkyw/NEvqJhlYCAAFMAAlzZXNzaW9uSWRxAH4AA3hwdAAPc29tZS1zZXNzaW9uLWlkdAANaWRwIGVudGl0eSBpZH5yAC11ay5nb3YuaWRhLmh1Yi5wb2xpY3kuZG9tYWluLkxldmVsT2ZBc3N1cmFuY2UAAAAAAAAAABIAAHhyAA5qYXZhLmxhbmcuRW51bQAAAAAAAAAAEgAAeHB0AAdMRVZFTF8ydAAXbWF0Y2hpbmdTZXJ2aWNlRW50aXR5SWRwc3EAfgAQAAAAhD8OiABxAH4AFQ==",
            expectedState
        );
    }

    @Test
    public void shouldDeserializeCycle0And1MatchRequestSentState() {
        Cycle0And1MatchRequestSentState expectedState = aCycle0And1MatchRequestSentState().withSessionId(SESSION_ID).build();
        assertDeserializedForm(
            "rO0ABXNyAEJ1ay5nb3YuaWRhLmh1Yi5wb2xpY3kuZG9tYWluLnN0YXRlLkN5Y2xlMEFuZDFNYXRjaFJlcXVlc3RTZW50U3RhdGXts9XbghVRMgIAA0wAF2F1dGhuU3RhdGVtZW50QXNzZXJ0aW9udAASTGphdmEvbGFuZy9TdHJpbmc7TAAhZW5jcnlwdGVkTWF0Y2hpbmdEYXRhc2V0QXNzZXJ0aW9ucQB+AAFMAAxwZXJzaXN0ZW50SWR0ACtMdWsvZ292L2lkYS9odWIvcG9saWN5L2RvbWFpbi9QZXJzaXN0ZW50SWQ7eHIAOHVrLmdvdi5pZGEuaHViLnBvbGljeS5kb21haW4uc3RhdGUuTWF0Y2hSZXF1ZXN0U2VudFN0YXRl64fl+5BnrWECAAFaAAtyZWdpc3RlcmluZ3hyAEB1ay5nb3YuaWRhLmh1Yi5wb2xpY3kuZG9tYWluLnN0YXRlLkFic3RyYWN0TWF0Y2hSZXF1ZXN0U2VudFN0YXRl0xq6XMx9pY4CAAVMABhpZGVudGl0eVByb3ZpZGVyRW50aXR5SWRxAH4AAUwAE2lkcExldmVsT2ZBc3N1cmFuY2V0AC9MdWsvZ292L2lkYS9odWIvcG9saWN5L2RvbWFpbi9MZXZlbE9mQXNzdXJhbmNlO0wAHm1hdGNoaW5nU2VydmljZUFkYXB0ZXJFbnRpdHlJZHEAfgABTAAKcmVsYXlTdGF0ZXEAfgABTAAPcmVxdWVzdFNlbnRUaW1ldAAYTG9yZy9qb2RhL3RpbWUvRGF0ZVRpbWU7eHIAKnVrLmdvdi5pZGEuaHViLnBvbGljeS5kb21haW4uQWJzdHJhY3RTdGF0Zb5Jzqv8o1OGAgAHWgAYdHJhbnNhY3Rpb25TdXBwb3J0c0VpZGFzTAAbYXNzZXJ0aW9uQ29uc3VtZXJTZXJ2aWNlVXJpdAAOTGphdmEvbmV0L1VSSTtMABNmb3JjZUF1dGhlbnRpY2F0aW9udAATTGphdmEvbGFuZy9Cb29sZWFuO0wACXJlcXVlc3RJZHEAfgABTAAVcmVxdWVzdElzc3VlckVudGl0eUlkcQB+AAFMABZzZXNzaW9uRXhwaXJ5VGltZXN0YW1wcQB+AAZMAAlzZXNzaW9uSWR0AChMdWsvZ292L2lkYS9odWIvcG9saWN5L2RvbWFpbi9TZXNzaW9uSWQ7eHAAc3IADGphdmEubmV0LlVSSawBeC5DnkmrAwABTAAGc3RyaW5ncQB+AAF4cHQAE2RlZmF1bHQtc2VydmljZS11cml4cHQACXJlcXVlc3RJZHQAEXJlcXVlc3QtaXNzdWVyLWlkc3IAFm9yZy5qb2RhLnRpbWUuRGF0ZVRpbWW4PHhkalvd+QIAAHhyAB9vcmcuam9kYS50aW1lLmJhc2UuQmFzZURhdGVUaW1l///54U9dLqMCAAJKAAdpTWlsbGlzTAALaUNocm9ub2xvZ3l0ABpMb3JnL2pvZGEvdGltZS9DaHJvbm9sb2d5O3hwAAAAhD8Xr8BzcgAnb3JnLmpvZGEudGltZS5jaHJvbm8uSVNPQ2hyb25vbG9neSRTdHViqcgRZnE3UCcDAAB4cHNyAB9vcmcuam9kYS50aW1lLkRhdGVUaW1lWm9uZSRTdHVipi8BmnwyGuMDAAB4cHcFAANVVEN4eHNyACZ1ay5nb3YuaWRhLmh1Yi5wb2xpY3kuZG9tYWluLlNlc3Npb25JZMsPzRL6iYZWAgABTAAJc2Vzc2lvbklkcQB+AAF4cHQAD3NvbWUtc2Vzc2lvbi1pZHQADWlkcC1lbnRpdHktaWR+cgAtdWsuZ292LmlkYS5odWIucG9saWN5LmRvbWFpbi5MZXZlbE9mQXNzdXJhbmNlAAAAAAAAAAASAAB4cgAOamF2YS5sYW5nLkVudW0AAAAAAAAAABIAAHhwdAAHTEVWRUxfMXQAGW1hdGNoaW5nLXNlcnZpY2UtZW50aXR5SWRwc3EAfgARAAAAhD8OiABxAH4AFgB0ADZhUGFzc3Rocm91Z2hBc3NlcnRpb24oKS5idWlsZEF1dGhuU3RhdGVtZW50QXNzZXJ0aW9uKCl0ACRlbmNyeXB0ZWQtbWF0Y2hpbmctZGF0YXNldC1hc3NlcnRpb25zcgApdWsuZ292LmlkYS5odWIucG9saWN5LmRvbWFpbi5QZXJzaXN0ZW50SWTB/UPEwbB0xQIAAUwABm5hbWVJZHEAfgABeHB0AA9kZWZhdWx0LW5hbWUtaWQ=",
            expectedState
        );
    }

    @Test
    public void shouldDeserializeCycle3MatchRequestSentState() {
        Cycle3MatchRequestSentState expectedState = aCycle3MatchRequestSentState().withRequestId(REQUEST_ID).withSessionId(SESSION_ID).build();
        assertDeserializedForm(
            "rO0ABXNyAD51ay5nb3YuaWRhLmh1Yi5wb2xpY3kuZG9tYWluLnN0YXRlLkN5Y2xlM01hdGNoUmVxdWVzdFNlbnRTdGF0ZWR4pmo5LksfAgAAeHIAQnVrLmdvdi5pZGEuaHViLnBvbGljeS5kb21haW4uc3RhdGUuQ3ljbGUwQW5kMU1hdGNoUmVxdWVzdFNlbnRTdGF0Ze2z1duCFVEyAgADTAAXYXV0aG5TdGF0ZW1lbnRBc3NlcnRpb250ABJMamF2YS9sYW5nL1N0cmluZztMACFlbmNyeXB0ZWRNYXRjaGluZ0RhdGFzZXRBc3NlcnRpb25xAH4AAkwADHBlcnNpc3RlbnRJZHQAK0x1ay9nb3YvaWRhL2h1Yi9wb2xpY3kvZG9tYWluL1BlcnNpc3RlbnRJZDt4cgA4dWsuZ292LmlkYS5odWIucG9saWN5LmRvbWFpbi5zdGF0ZS5NYXRjaFJlcXVlc3RTZW50U3RhdGXrh+X7kGetYQIAAVoAC3JlZ2lzdGVyaW5neHIAQHVrLmdvdi5pZGEuaHViLnBvbGljeS5kb21haW4uc3RhdGUuQWJzdHJhY3RNYXRjaFJlcXVlc3RTZW50U3RhdGXTGrpczH2ljgIABUwAGGlkZW50aXR5UHJvdmlkZXJFbnRpdHlJZHEAfgACTAATaWRwTGV2ZWxPZkFzc3VyYW5jZXQAL0x1ay9nb3YvaWRhL2h1Yi9wb2xpY3kvZG9tYWluL0xldmVsT2ZBc3N1cmFuY2U7TAAebWF0Y2hpbmdTZXJ2aWNlQWRhcHRlckVudGl0eUlkcQB+AAJMAApyZWxheVN0YXRlcQB+AAJMAA9yZXF1ZXN0U2VudFRpbWV0ABhMb3JnL2pvZGEvdGltZS9EYXRlVGltZTt4cgAqdWsuZ292LmlkYS5odWIucG9saWN5LmRvbWFpbi5BYnN0cmFjdFN0YXRlvknOq/yjU4YCAAdaABh0cmFuc2FjdGlvblN1cHBvcnRzRWlkYXNMABthc3NlcnRpb25Db25zdW1lclNlcnZpY2VVcml0AA5MamF2YS9uZXQvVVJJO0wAE2ZvcmNlQXV0aGVudGljYXRpb250ABNMamF2YS9sYW5nL0Jvb2xlYW47TAAJcmVxdWVzdElkcQB+AAJMABVyZXF1ZXN0SXNzdWVyRW50aXR5SWRxAH4AAkwAFnNlc3Npb25FeHBpcnlUaW1lc3RhbXBxAH4AB0wACXNlc3Npb25JZHQAKEx1ay9nb3YvaWRhL2h1Yi9wb2xpY3kvZG9tYWluL1Nlc3Npb25JZDt4cABzcgAMamF2YS5uZXQuVVJJrAF4LkOeSasDAAFMAAZzdHJpbmdxAH4AAnhwdAAWL2RlZmF1bHQtc2VydmljZS1pbmRleHhwdAAPc29tZS1yZXF1ZXN0LWlkdAARcmVxdWVzdCBpc3N1ZXIgaWRzcgAWb3JnLmpvZGEudGltZS5EYXRlVGltZbg8eGRqW935AgAAeHIAH29yZy5qb2RhLnRpbWUuYmFzZS5CYXNlRGF0ZVRpbWX///nhT10uowIAAkoAB2lNaWxsaXNMAAtpQ2hyb25vbG9neXQAGkxvcmcvam9kYS90aW1lL0Nocm9ub2xvZ3k7eHAAAACEPxevwHNyACdvcmcuam9kYS50aW1lLmNocm9uby5JU09DaHJvbm9sb2d5JFN0dWKpyBFmcTdQJwMAAHhwc3IAH29yZy5qb2RhLnRpbWUuRGF0ZVRpbWVab25lJFN0dWKmLwGafDIa4wMAAHhwdwUAA1VUQ3h4c3IAJnVrLmdvdi5pZGEuaHViLnBvbGljeS5kb21haW4uU2Vzc2lvbklkyw/NEvqJhlYCAAFMAAlzZXNzaW9uSWRxAH4AAnhwdAAPc29tZS1zZXNzaW9uLWlkdAANaWRwIGVudGl0eSBpZH5yAC11ay5nb3YuaWRhLmh1Yi5wb2xpY3kuZG9tYWluLkxldmVsT2ZBc3N1cmFuY2UAAAAAAAAAABIAAHhyAA5qYXZhLmxhbmcuRW51bQAAAAAAAAAAEgAAeHB0AAdMRVZFTF8xdAAXbWF0Y2hpbmdTZXJ2aWNlRW50aXR5SWRwc3EAfgASAAAAhD8OiABxAH4AFwB0ADZhUGFzc3Rocm91Z2hBc3NlcnRpb24oKS5idWlsZEF1dGhuU3RhdGVtZW50QXNzZXJ0aW9uKCl0ACRlbmNyeXB0ZWQtbWF0Y2hpbmctZGF0YXNldC1hc3NlcnRpb25zcgApdWsuZ292LmlkYS5odWIucG9saWN5LmRvbWFpbi5QZXJzaXN0ZW50SWTB/UPEwbB0xQIAAUwABm5hbWVJZHEAfgACeHB0AA9kZWZhdWx0LW5hbWUtaWQ=",
            expectedState
        );
    }

    @Test
    public void shouldDeserializePausedRegistrationState() {
        PausedRegistrationState expectedState = aPausedRegistrationState().build();
        assertDeserializedForm(
            "rO0ABXNyADp1ay5nb3YuaWRhLmh1Yi5wb2xpY3kuZG9tYWluLnN0YXRlLlBhdXNlZFJlZ2lzdHJhdGlvblN0YXRlceqKI+3fvs8CAAFMAApyZWxheVN0YXRldAASTGphdmEvbGFuZy9TdHJpbmc7eHIAKnVrLmdvdi5pZGEuaHViLnBvbGljeS5kb21haW4uQWJzdHJhY3RTdGF0Zb5Jzqv8o1OGAgAHWgAYdHJhbnNhY3Rpb25TdXBwb3J0c0VpZGFzTAAbYXNzZXJ0aW9uQ29uc3VtZXJTZXJ2aWNlVXJpdAAOTGphdmEvbmV0L1VSSTtMABNmb3JjZUF1dGhlbnRpY2F0aW9udAATTGphdmEvbGFuZy9Cb29sZWFuO0wACXJlcXVlc3RJZHEAfgABTAAVcmVxdWVzdElzc3VlckVudGl0eUlkcQB+AAFMABZzZXNzaW9uRXhwaXJ5VGltZXN0YW1wdAAYTG9yZy9qb2RhL3RpbWUvRGF0ZVRpbWU7TAAJc2Vzc2lvbklkdAAoTHVrL2dvdi9pZGEvaHViL3BvbGljeS9kb21haW4vU2Vzc2lvbklkO3hwAXNyAAxqYXZhLm5ldC5VUkmsAXguQ55JqwMAAUwABnN0cmluZ3EAfgABeHB0ACN1cm46c29tZTphc3NlcnRpb246Y29uc3VtZXI6c2VydmljZXhwdAAPc29tZS1yZXF1ZXN0LWlkdAAWc29tZS1yZXF1ZXN0LWlzc3Vlci1pZHNyABZvcmcuam9kYS50aW1lLkRhdGVUaW1luDx4ZGpb3fkCAAB4cgAfb3JnLmpvZGEudGltZS5iYXNlLkJhc2VEYXRlVGltZf//+eFPXS6jAgACSgAHaU1pbGxpc0wAC2lDaHJvbm9sb2d5dAAaTG9yZy9qb2RhL3RpbWUvQ2hyb25vbG9neTt4cAAAAIQ/DogAc3IAJ29yZy5qb2RhLnRpbWUuY2hyb25vLklTT0Nocm9ub2xvZ3kkU3R1YqnIEWZxN1AnAwAAeHBzcgAfb3JnLmpvZGEudGltZS5EYXRlVGltZVpvbmUkU3R1YqYvAZp8MhrjAwAAeHB3BQADVVRDeHhzcgAmdWsuZ292LmlkYS5odWIucG9saWN5LmRvbWFpbi5TZXNzaW9uSWTLD80S+omGVgIAAUwACXNlc3Npb25JZHEAfgABeHB0AA9zb21lLXNlc3Npb24taWR0ABBzb21lLXJlbGF5LXN0YXRl",
            expectedState
        );
    }

    @Test
    public void shouldDeserializeTimeoutState() {
        TimeoutState expectedState = aTimeoutState().withSessionId(SESSION_ID).build();
        assertDeserializedForm(
            "rO0ABXNyAC91ay5nb3YuaWRhLmh1Yi5wb2xpY3kuZG9tYWluLnN0YXRlLlRpbWVvdXRTdGF0ZcMS6IFiHl9kAgAAeHIAKnVrLmdvdi5pZGEuaHViLnBvbGljeS5kb21haW4uQWJzdHJhY3RTdGF0Zb5Jzqv8o1OGAgAGWgAYdHJhbnNhY3Rpb25TdXBwb3J0c0VpZGFzTAAbYXNzZXJ0aW9uQ29uc3VtZXJTZXJ2aWNlVXJpdAAOTGphdmEvbmV0L1VSSTtMAAlyZXF1ZXN0SWR0ABJMamF2YS9sYW5nL1N0cmluZztMABVyZXF1ZXN0SXNzdWVyRW50aXR5SWRxAH4AA0wAFnNlc3Npb25FeHBpcnlUaW1lc3RhbXB0ABhMb3JnL2pvZGEvdGltZS9EYXRlVGltZTtMAAlzZXNzaW9uSWR0AChMdWsvZ292L2lkYS9odWIvcG9saWN5L2RvbWFpbi9TZXNzaW9uSWQ7eHAAc3IADGphdmEubmV0LlVSSawBeC5DnkmrAwABTAAGc3RyaW5ncQB+AAN4cHQAG2Fzc2VydGlvbkNvbnN1bWVyU2VydmljZVVyaXh0AAlyZXF1ZXN0SWRxAH4ACnNyABZvcmcuam9kYS50aW1lLkRhdGVUaW1luDx4ZGpb3fkCAAB4cgAfb3JnLmpvZGEudGltZS5iYXNlLkJhc2VEYXRlVGltZf//+eFPXS6jAgACSgAHaU1pbGxpc0wAC2lDaHJvbm9sb2d5dAAaTG9yZy9qb2RhL3RpbWUvQ2hyb25vbG9neTt4cAAAAIQ/RXaAc3IAJ29yZy5qb2RhLnRpbWUuY2hyb25vLklTT0Nocm9ub2xvZ3kkU3R1YqnIEWZxN1AnAwAAeHBzcgAfb3JnLmpvZGEudGltZS5EYXRlVGltZVpvbmUkU3R1YqYvAZp8MhrjAwAAeHB3BQADVVRDeHhzcgAmdWsuZ292LmlkYS5odWIucG9saWN5LmRvbWFpbi5TZXNzaW9uSWTLD80S+omGVgIAAUwACXNlc3Npb25JZHEAfgADeHB0AA9zb21lLXNlc3Npb24taWQ=",
            expectedState
        );
    }

    @Test
    public void shouldDeserializeAuthnFailedErrorState() {
        AuthnFailedErrorState expectedState = anAuthnFailedErrorState().withRequestId(REQUEST_ID).withSessionId(SESSION_ID).withForceAuthentication(null).build();
        assertDeserializedForm(
            "rO0ABXNyADh1ay5nb3YuaWRhLmh1Yi5wb2xpY3kuZG9tYWluLnN0YXRlLkF1dGhuRmFpbGVkRXJyb3JTdGF0ZXBsjfprBk5ZAgADTAATZm9yY2VBdXRoZW50aWNhdGlvbnQAE0xqYXZhL2xhbmcvQm9vbGVhbjtMAAtpZHBFbnRpdHlJZHQAEkxqYXZhL2xhbmcvU3RyaW5nO0wACnJlbGF5U3RhdGVxAH4AAnhyACp1ay5nb3YuaWRhLmh1Yi5wb2xpY3kuZG9tYWluLkFic3RyYWN0U3RhdGW+Sc6r/KNThgIABloAGHRyYW5zYWN0aW9uU3VwcG9ydHNFaWRhc0wAG2Fzc2VydGlvbkNvbnN1bWVyU2VydmljZVVyaXQADkxqYXZhL25ldC9VUkk7TAAJcmVxdWVzdElkcQB+AAJMABVyZXF1ZXN0SXNzdWVyRW50aXR5SWRxAH4AAkwAFnNlc3Npb25FeHBpcnlUaW1lc3RhbXB0ABhMb3JnL2pvZGEvdGltZS9EYXRlVGltZTtMAAlzZXNzaW9uSWR0AChMdWsvZ292L2lkYS9odWIvcG9saWN5L2RvbWFpbi9TZXNzaW9uSWQ7eHAAc3IADGphdmEubmV0LlVSSawBeC5DnkmrAwABTAAGc3RyaW5ncQB+AAJ4cHQAFi9kZWZhdWx0LXNlcnZpY2UtaW5kZXh4dAAPc29tZS1yZXF1ZXN0LWlkdAAPcmVxdWVzdElzc3Vlcklkc3IAFm9yZy5qb2RhLnRpbWUuRGF0ZVRpbWW4PHhkalvd+QIAAHhyAB9vcmcuam9kYS50aW1lLmJhc2UuQmFzZURhdGVUaW1l///54U9dLqMCAAJKAAdpTWlsbGlzTAALaUNocm9ub2xvZ3l0ABpMb3JnL2pvZGEvdGltZS9DaHJvbm9sb2d5O3hwAAAAhD8Xr8BzcgAnb3JnLmpvZGEudGltZS5jaHJvbm8uSVNPQ2hyb25vbG9neSRTdHViqcgRZnE3UCcDAAB4cHNyAB9vcmcuam9kYS50aW1lLkRhdGVUaW1lWm9uZSRTdHVipi8BmnwyGuMDAAB4cHcFAANVVEN4eHNyACZ1ay5nb3YuaWRhLmh1Yi5wb2xpY3kuZG9tYWluLlNlc3Npb25JZMsPzRL6iYZWAgABTAAJc2Vzc2lvbklkcQB+AAJ4cHQAD3NvbWUtc2Vzc2lvbi1pZHNyABFqYXZhLmxhbmcuQm9vbGVhbs0gcoDVnPruAgABWgAFdmFsdWV4cAF0AA1JRFAgRW50aXR5IElEcA==",
            expectedState
        );
    }

    @Test
    public void shouldDeserializeCountryAuthnFailedErrorState() {
        EidasAuthnFailedErrorState expectedState = anEidasAuthnFailedErrorState().withRequestId(REQUEST_ID).withSessionId(SESSION_ID).build();
        assertDeserializedForm(
            "rO0ABXNyAD11ay5nb3YuaWRhLmh1Yi5wb2xpY3kuZG9tYWluLnN0YXRlLkVpZGFzQXV0aG5GYWlsZWRFcnJvclN0YXRlq4ZZgq+VP7cCAAJMAA9jb3VudHJ5RW50aXR5SWR0ABJMamF2YS9sYW5nL1N0cmluZztMABFsZXZlbHNPZkFzc3VyYW5jZXQAEExqYXZhL3V0aWwvTGlzdDt4cgBAdWsuZ292LmlkYS5odWIucG9saWN5LmRvbWFpbi5zdGF0ZS5BYnN0cmFjdEF1dGhuRmFpbGVkRXJyb3JTdGF0ZXBsjfprBk5ZAgABTAAKcmVsYXlTdGF0ZXEAfgABeHIAKnVrLmdvdi5pZGEuaHViLnBvbGljeS5kb21haW4uQWJzdHJhY3RTdGF0Zb5Jzqv8o1OGAgAHWgAYdHJhbnNhY3Rpb25TdXBwb3J0c0VpZGFzTAAbYXNzZXJ0aW9uQ29uc3VtZXJTZXJ2aWNlVXJpdAAOTGphdmEvbmV0L1VSSTtMABNmb3JjZUF1dGhlbnRpY2F0aW9udAATTGphdmEvbGFuZy9Cb29sZWFuO0wACXJlcXVlc3RJZHEAfgABTAAVcmVxdWVzdElzc3VlckVudGl0eUlkcQB+AAFMABZzZXNzaW9uRXhwaXJ5VGltZXN0YW1wdAAYTG9yZy9qb2RhL3RpbWUvRGF0ZVRpbWU7TAAJc2Vzc2lvbklkdAAoTHVrL2dvdi9pZGEvaHViL3BvbGljeS9kb21haW4vU2Vzc2lvbklkO3hwAXNyAAxqYXZhLm5ldC5VUkmsAXguQ55JqwMAAUwABnN0cmluZ3EAfgABeHB0ABYvZGVmYXVsdC1zZXJ2aWNlLWluZGV4eHNyABFqYXZhLmxhbmcuQm9vbGVhbs0gcoDVnPruAgABWgAFdmFsdWV4cAB0AA9zb21lLXJlcXVlc3QtaWR0AA9yZXF1ZXN0SXNzdWVySWRzcgAWb3JnLmpvZGEudGltZS5EYXRlVGltZbg8eGRqW935AgAAeHIAH29yZy5qb2RhLnRpbWUuYmFzZS5CYXNlRGF0ZVRpbWX///nhT10uowIAAkoAB2lNaWxsaXNMAAtpQ2hyb25vbG9neXQAGkxvcmcvam9kYS90aW1lL0Nocm9ub2xvZ3k7eHAAAACEPxevwHNyACdvcmcuam9kYS50aW1lLmNocm9uby5JU09DaHJvbm9sb2d5JFN0dWKpyBFmcTdQJwMAAHhwc3IAH29yZy5qb2RhLnRpbWUuRGF0ZVRpbWVab25lJFN0dWKmLwGafDIa4wMAAHhwdwUAA1VUQ3h4c3IAJnVrLmdvdi5pZGEuaHViLnBvbGljeS5kb21haW4uU2Vzc2lvbklkyw/NEvqJhlYCAAFMAAlzZXNzaW9uSWRxAH4AAXhwdAAPc29tZS1zZXNzaW9uLWlkcHQAPWh0dHBzOi8vc3R1Yl9jb3VudHJ5LmFjbWUuZXUvc3R1Yi1jb3VudHJ5LW9uZS9TZXJ2aWNlTWV0YWRhdGFzcgAjamF2YS51dGlsLkNvbGxlY3Rpb25zJFNpbmdsZXRvbkxpc3Qq7ykQPKeblwIAAUwAB2VsZW1lbnR0ABJMamF2YS9sYW5nL09iamVjdDt4cH5yAC11ay5nb3YuaWRhLmh1Yi5wb2xpY3kuZG9tYWluLkxldmVsT2ZBc3N1cmFuY2UAAAAAAAAAABIAAHhyAA5qYXZhLmxhbmcuRW51bQAAAAAAAAAAEgAAeHB0AAdMRVZFTF8y",
            expectedState
        );
    }

    @Test
    public void shouldDeserializeFraudEventDetectedState() {
        FraudEventDetectedState expectedState = aFraudEventDetectedState().withSessionId(SESSION_ID).withForceAuthentication(null).build();
        assertDeserializedForm(
            "rO0ABXNyADp1ay5nb3YuaWRhLmh1Yi5wb2xpY3kuZG9tYWluLnN0YXRlLkZyYXVkRXZlbnREZXRlY3RlZFN0YXRljQftR3R5bEMCAAB4cgA4dWsuZ292LmlkYS5odWIucG9saWN5LmRvbWFpbi5zdGF0ZS5BdXRobkZhaWxlZEVycm9yU3RhdGVwbI36awZOWQIAAUwAC2lkcEVudGl0eUlkdAASTGphdmEvbGFuZy9TdHJpbmc7eHIAQHVrLmdvdi5pZGEuaHViLnBvbGljeS5kb21haW4uc3RhdGUuQWJzdHJhY3RBdXRobkZhaWxlZEVycm9yU3RhdGVwbI36awZOWQIAAUwACnJlbGF5U3RhdGVxAH4AAnhyACp1ay5nb3YuaWRhLmh1Yi5wb2xpY3kuZG9tYWluLkFic3RyYWN0U3RhdGW+Sc6r/KNThgIAB1oAGHRyYW5zYWN0aW9uU3VwcG9ydHNFaWRhc0wAG2Fzc2VydGlvbkNvbnN1bWVyU2VydmljZVVyaXQADkxqYXZhL25ldC9VUkk7TAATZm9yY2VBdXRoZW50aWNhdGlvbnQAE0xqYXZhL2xhbmcvQm9vbGVhbjtMAAlyZXF1ZXN0SWRxAH4AAkwAFXJlcXVlc3RJc3N1ZXJFbnRpdHlJZHEAfgACTAAWc2Vzc2lvbkV4cGlyeVRpbWVzdGFtcHQAGExvcmcvam9kYS90aW1lL0RhdGVUaW1lO0wACXNlc3Npb25JZHQAKEx1ay9nb3YvaWRhL2h1Yi9wb2xpY3kvZG9tYWluL1Nlc3Npb25JZDt4cABzcgAMamF2YS5uZXQuVVJJrAF4LkOeSasDAAFMAAZzdHJpbmdxAH4AAnhwdAAbYXNzZXJ0aW9uQ29uc3VtZXJTZXJ2aWNlVXJpeHB0AAlyZXF1ZXN0SWRxAH4ADXNyABZvcmcuam9kYS50aW1lLkRhdGVUaW1luDx4ZGpb3fkCAAB4cgAfb3JnLmpvZGEudGltZS5iYXNlLkJhc2VEYXRlVGltZf//+eFPXS6jAgACSgAHaU1pbGxpc0wAC2lDaHJvbm9sb2d5dAAaTG9yZy9qb2RhL3RpbWUvQ2hyb25vbG9neTt4cAAAAIQ/RXaAc3IAJ29yZy5qb2RhLnRpbWUuY2hyb25vLklTT0Nocm9ub2xvZ3kkU3R1YqnIEWZxN1AnAwAAeHBzcgAfb3JnLmpvZGEudGltZS5EYXRlVGltZVpvbmUkU3R1YqYvAZp8MhrjAwAAeHB3BQADVVRDeHhzcgAmdWsuZ292LmlkYS5odWIucG9saWN5LmRvbWFpbi5TZXNzaW9uSWTLD80S+omGVgIAAUwACXNlc3Npb25JZHEAfgACeHB0AA9zb21lLXNlc3Npb24taWR0AApyZWxheVN0YXRldAALaWRwRW50aXR5SWQ=",
            expectedState
        );
    }
}
